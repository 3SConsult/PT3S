<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dxAndMxHelperFcts &mdash; PT3S 90.14.35.0.dev1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css" />

  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html">
            
              <img src="../_static/pt3s_logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers.html">For Developers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PT3S</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">dxAndMxHelperFcts</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dxAndMxHelperFcts</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Created on Tue Jan 30 10:36:59 2024</span>

<span class="sd">@author: wolters</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">os</span> <span class="kn">import</span> <span class="n">access</span><span class="p">,</span> <span class="n">R_OK</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">isfile</span>

<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>    

<span class="c1">#import importlib</span>
<span class="kn">import</span> <span class="nn">glob</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="kn">import</span> <span class="nn">pickle</span>

<span class="kn">import</span> <span class="nn">geopandas</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">import</span> <span class="nn">subprocess</span>




<span class="c1"># ---</span>
<span class="c1"># --- PT3S Imports</span>
<span class="c1"># ---</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;PT3S&#39;</span><span class="p">)</span>  
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;in MODULEFILE: __main__ Context:&#39;</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">))</span> 
<span class="k">else</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}{2:s}{3:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;in MODULEFILE: Not __main__ Context: &#39;</span><span class="p">,</span><span class="s1">&#39;__name__: &#39;</span><span class="p">,</span><span class="vm">__name__</span><span class="p">,</span><span class="s2">&quot; .&quot;</span><span class="p">))</span> 

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PT3S</span> <span class="kn">import</span> <span class="n">Dx</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ImportError: &#39;</span><span class="p">,</span><span class="s1">&#39;from PT3S import Dx - trying import Dx instead ... maybe pip install -e . is active ...&#39;</span><span class="p">))</span> 
    <span class="kn">import</span> <span class="nn">Dx</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PT3S</span> <span class="kn">import</span> <span class="n">Mx</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;ImportError: &#39;</span><span class="p">,</span><span class="s1">&#39;from PT3S import Mx - trying import Mx instead ... maybe pip install -e . is active ...&#39;</span><span class="p">))</span> 
    <span class="kn">import</span> <span class="nn">Mx</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">PT3S</span> <span class="kn">import</span> <span class="n">dxDecodeObjsData</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">dxDecodeObjsData</span>


<span class="k">class</span> <span class="nc">dxWithMxError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">dxWithMx</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for dx with attached mx.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param dx: a Dx object</span>
<span class="sd">        :type dx: Dx.Dx()</span>
<span class="sd">        :param mx: a Mx object</span>
<span class="sd">        :type mx: Mx.Mx()        </span>
<span class="sd">        :param crs: (=coordinate reference system) Determines crs used in geopandas-Dfs (Possible value:&#39;EPSG:25832&#39;). If None, crs will be read from SIR 3S&#39; database file.</span>
<span class="sd">        :type crs: str, optional, default=None  </span>
<span class="sd">                      </span>
<span class="sd">        .. note:: a dxWithMx object is returned by dxAndMxHelperFcts.readDxAndMx(); see also documentation there; the object is a wrapper for Dx with attached Mx; a dxWithMx object is allso called m object in this documentation  </span>
<span class="sd">                        </span>
<span class="sd">        &quot;&quot;&quot;</span>        
        
        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Start.&#39;</span><span class="p">))</span> 
        
        <span class="k">try</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span>
            <span class="c1">#self.mx = mx</span>
            
            <span class="c1">#self.dfLAYR=self._dfLAYR()    </span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">dfWBLZ</span><span class="o">=</span><span class="n">dxDecodeObjsData</span><span class="o">.</span><span class="n">Wblz</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dfAGSN</span><span class="o">=</span><span class="n">dxDecodeObjsData</span><span class="o">.</span><span class="n">Agsn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>            
                        
            <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_ROHR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
        
            
            <span class="c1">### A</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">V3_KNOT</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_KNOT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">V3_VBEL</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_VBEL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">V3_FWVB</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_FWVB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">Mx</span><span class="o">.</span><span class="n">Mx</span><span class="p">):</span>  
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdf_FWVB</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gdf_ROHR</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gdf_KNOT</span><span class="p">)</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gdfs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
                          
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">Mx</span><span class="o">.</span><span class="n">Mx</span><span class="p">):</span>  
                                
                <span class="bp">self</span><span class="o">.</span><span class="n">mx</span> <span class="o">=</span> <span class="n">mx</span>
                
                <span class="n">modellName</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dbFile</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">: processing dx and mx ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">modellName</span><span class="p">)))</span>                 
                
                <span class="c1"># mx2Idx to V3_KNOT, V3_ROHR, V3_FWVB, etc.</span>
                <span class="c1"># mx2NofPts to V3_ROHR  </span>
                <span class="c1"># mx2Idx to V3_VBEL</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">MxSync</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_ROHR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                               
                
                <span class="c1">### B</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_KNOT</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_KNOT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_VBEL</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_VBEL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_FWVB</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_FWVB&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
                                
                <span class="c1"># Vec-Results to V3_KNOT, V3_ROHR, V3_FWVB, etc.</span>
                <span class="n">V3sErg</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">MxAdd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="p">)</span>                
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="o">=</span><span class="n">V3sErg</span><span class="p">[</span><span class="s1">&#39;V3_ROHR&#39;</span><span class="p">]</span>    
                
                <span class="c1">### C</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_KNOT</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_V3_KNOT</span><span class="p">(</span><span class="n">V3sErg</span><span class="p">[</span><span class="s1">&#39;V3_KNOT&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_VBEL</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_V3_VBEL</span><span class="p">(</span><span class="n">V3sErg</span><span class="p">[</span><span class="s1">&#39;V3_VBEL&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_FWVB</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_V3_FWVB</span><span class="p">(</span><span class="n">V3sErg</span><span class="p">[</span><span class="s1">&#39;V3_FWVB&#39;</span><span class="p">])</span>
                
                <span class="n">t0</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> </span><span class="si">%X</span><span class="s1">.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">))</span>
                                                                                                            
                <span class="c1"># ROHR                                 </span>
                <span class="k">try</span><span class="p">:</span>                                    
                    <span class="c1">#t0=pd.Timestamp(self.mx.df.index[0].strftime(&#39;%Y-%m-%d %X.%f&#39;))</span>
                    <span class="n">QMAV</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span>
                                <span class="p">,</span><span class="s1">&#39;ROHR~*~*~*~QMAV&#39;</span>
                                <span class="p">,</span><span class="n">t0</span>
                                <span class="p">,</span><span class="n">t0</span>
                                <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="p">[</span><span class="s1">&#39;QMAVAbs&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">QMAV</span><span class="p">])</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>      
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_ROHR[&#39;QMAVAbs&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col QMAVAbs=Abs(STAT ROHR~*~*~*~QMAV) in V3_ROHR failed.&#39;</span><span class="p">))</span>   
                    
                <span class="k">try</span><span class="p">:</span>                                                        
                    <span class="n">VAV</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span>
                                <span class="p">,</span><span class="s1">&#39;ROHR~*~*~*~VAV&#39;</span>
                                <span class="p">,</span><span class="n">t0</span>
                                <span class="p">,</span><span class="n">t0</span>
                                <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="p">[</span><span class="s1">&#39;VAVAbs&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">VAV</span><span class="p">])</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>       
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_ROHR[&#39;VAVAbs&#39;] ok so far.&quot;</span><span class="p">))</span>                                                         
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col VAVAbs=Abs(STAT ROHR~*~*~*~VAV) in V3_ROHR failed.&#39;</span><span class="p">))</span>       
                    
                <span class="k">try</span><span class="p">:</span>                                                        
                    <span class="n">PHR</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span>
                                <span class="p">,</span><span class="s1">&#39;ROHR~*~*~*~PHR&#39;</span>
                                <span class="p">,</span><span class="n">t0</span>
                                <span class="p">,</span><span class="n">t0</span>
                                <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="p">[</span><span class="s1">&#39;PHRAbs&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">PHR</span><span class="p">])</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>     
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_ROHR[&#39;PHRAbs&#39;] ok so far.&quot;</span><span class="p">))</span>                                                           
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col PHRAbs=Abs(STAT ROHR~*~*~*~PHR) in V3_ROHR failed.&#39;</span><span class="p">))</span>     

                <span class="k">try</span><span class="p">:</span>                                                        
                    <span class="n">JV</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span>
                                <span class="p">,</span><span class="s1">&#39;ROHR~*~*~*~JV&#39;</span>
                                <span class="p">,</span><span class="n">t0</span>
                                <span class="p">,</span><span class="n">t0</span>
                                <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="p">[</span><span class="s1">&#39;JVAbs&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">JV</span><span class="p">])</span> <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>      
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_ROHR[&#39;JVAbs&#39;] ok so far.&quot;</span><span class="p">))</span>                                                          
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col JVAbs=Abs(STAT ROHR~*~*~*~JV) in V3_ROHR failed.&#39;</span><span class="p">))</span> 
                             
                                                                            
                <span class="c1"># ROHRVEC</span>
                <span class="k">try</span><span class="p">:</span>   
                    <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHRVEC</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_V3_ROHRVEC</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="p">)</span>                
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_ROHRVEC ok so far.&quot;</span><span class="p">))</span>                                                      
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing of V3_ROHRVEC failed.&#39;</span><span class="p">))</span>                 
                
                    
                    
                <span class="c1"># # FWVB</span>
                <span class="c1"># if not self.V3_FWVB.empty:</span>
                <span class="c1">#     try:                                                         </span>
                <span class="c1">#          W=(&#39;STAT&#39;</span>
                <span class="c1">#                      ,&#39;FWVB~*~*~*~W&#39;</span>
                <span class="c1">#                      ,t0</span>
                <span class="c1">#                      ,t0</span>
                <span class="c1">#                      )</span>
                <span class="c1">#          self.V3_FWVB[&#39;W&#39;]=self.V3_FWVB[W]</span>
                <span class="c1">#          logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&quot;Constructing of V3_FWVB[&#39;W&#39;] ok so far.&quot;))                                                      </span>
                <span class="c1">#     except Exception as e:</span>
                <span class="c1">#          logStrTmp=&quot;{:s}Exception: Line: {:d}: {!s:s}: {:s}&quot;.format(logStr,sys.exc_info()[-1].tb_lineno,type(e),str(e))</span>
                <span class="c1">#          logger.debug(logStrTmp) </span>
                <span class="c1">#          logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&#39;Constructing col W in V3_FWVB failed.&#39;))   </span>
                         
                <span class="c1">#     try:                                             </span>
                <span class="c1">#          QM=(&#39;STAT&#39;</span>
                <span class="c1">#                      ,&#39;FWVB~*~*~*~QM&#39;</span>
                <span class="c1">#                      ,t0</span>
                <span class="c1">#                      ,t0</span>
                <span class="c1">#                      )</span>
                <span class="c1">#          self.V3_FWVB[&#39;QM&#39;]=self.V3_FWVB[QM]</span>
                <span class="c1">#          logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&quot;Constructing of V3_FWVB[&#39;QM&#39;] ok so far.&quot;))                                                      </span>
                <span class="c1">#     except Exception as e:</span>
                <span class="c1">#          logStrTmp=&quot;{:s}Exception: Line: {:d}: {!s:s}: {:s}&quot;.format(logStr,sys.exc_info()[-1].tb_lineno,type(e),str(e))</span>
                <span class="c1">#          logger.debug(logStrTmp) </span>
                <span class="c1">#          logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&#39;Constructing col QM in V3_FWVB failed.&#39;))     </span>
                         
                <span class="c1">#     try:     </span>
                <span class="c1">#          TI=(&#39;STAT&#39;</span>
                <span class="c1">#                      ,&#39;FWVB~*~*~*~TI&#39;</span>
                <span class="c1">#                      ,t0</span>
                <span class="c1">#                      ,t0</span>
                <span class="c1">#                      )</span>
                <span class="c1">#          self.V3_FWVB[&#39;TI&#39;]=self.V3_FWVB[TI]</span>
                <span class="c1">#          logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&quot;Constructing of V3_FWVB[&#39;TI&#39;] ok so far.&quot;))                                                      </span>
                <span class="c1">#     except Exception as e:</span>
                <span class="c1">#          logStrTmp=&quot;{:s}Exception: Line: {:d}: {!s:s}: {:s}&quot;.format(logStr,sys.exc_info()[-1].tb_lineno,type(e),str(e))</span>
                <span class="c1">#          logger.debug(logStrTmp) </span>
                <span class="c1">#          logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&#39;Constructing col TI in V3_FWVB failed.&#39;))    </span>
    
                <span class="c1">#     try:     </span>
                <span class="c1">#          TK=(&#39;STAT&#39;</span>
                <span class="c1">#                      ,&#39;FWVB~*~*~*~TK&#39;</span>
                <span class="c1">#                      ,t0</span>
                <span class="c1">#                      ,t0</span>
                <span class="c1">#                      )</span>
                <span class="c1">#          self.V3_FWVB[&#39;TK&#39;]=self.V3_FWVB[TK]</span>
                <span class="c1">#          logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&quot;Constructing of V3_FWVB[&#39;TK&#39;] ok so far.&quot;))                                                      </span>
                <span class="c1">#     except Exception as e:</span>
                <span class="c1">#          logStrTmp=&quot;{:s}Exception: Line: {:d}: {!s:s}: {:s}&quot;.format(logStr,sys.exc_info()[-1].tb_lineno,type(e),str(e))</span>
                <span class="c1">#          logger.debug(logStrTmp) </span>
                <span class="c1">#          logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&#39;Constructing col TK in V3_FWVB failed.&#39;))    </span>
                     
                
                <span class="c1"># WBLZ</span>
                
                <span class="k">try</span><span class="p">:</span>                
                    <span class="n">V_WBLZ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V_WBLZ&#39;</span><span class="p">]</span>
                    <span class="n">df</span><span class="o">=</span><span class="n">V_WBLZ</span><span class="p">[[</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span><span class="s1">&#39;fkDE&#39;</span><span class="p">,</span><span class="s1">&#39;rk&#39;</span><span class="p">,</span><span class="s1">&#39;tk&#39;</span><span class="p">,</span><span class="s1">&#39;BESCHREIBUNG&#39;</span><span class="p">,</span><span class="s1">&#39;NAME&#39;</span><span class="p">,</span><span class="s1">&#39;TYP&#39;</span><span class="p">,</span><span class="s1">&#39;AKTIV&#39;</span><span class="p">,</span><span class="s1">&#39;IDIM&#39;</span><span class="p">]]</span>
                    <span class="n">dfMx</span><span class="o">=</span><span class="n">mx</span><span class="o">.</span><span class="n">getVecAggsResultsForObjectType</span><span class="p">(</span><span class="n">Sir3sVecIDReExp</span><span class="o">=</span><span class="s1">&#39;^WBLZ~\*~\*~\*~&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">dfMx</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Adding MX-Results to V3_WBLZ: no such results.&#39;</span><span class="p">))</span>           
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dfMx</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">dfMx</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_flat_index</span><span class="p">()</span>                    
                        <span class="bp">self</span><span class="o">.</span><span class="n">V3_WBLZ</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">dfMx</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;tk&#39;</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Adding MX-Results to V3_WBLZ ok so far.&#39;</span><span class="p">))</span>                 
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing V3_WBLZ failed.&#39;</span><span class="p">))</span>
                
                <span class="c1">#gdfs                </span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdf_FWVB</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gdf_ROHR</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gdf_KNOT</span><span class="p">)</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_gdfs</span><span class="p">(</span><span class="n">crs</span><span class="p">)</span>
                


            <span class="c1"># G    </span>
                                
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Graph bauen    </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_VBEL</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">,</span> <span class="n">edge_attr</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> 
                <span class="n">nodeDct</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_KNOT</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>    
                <span class="n">nodeDctNx</span><span class="o">=</span><span class="p">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]:</span><span class="n">value</span><span class="o">|</span><span class="p">{</span><span class="s1">&#39;idx&#39;</span><span class="p">:</span><span class="n">key</span><span class="p">}</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">nodeDct</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span><span class="n">nodeDctNx</span><span class="p">)</span>     
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing NetworkX Graph G ok so far.&#39;</span><span class="p">))</span>                           
                
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing NetworkX Graph G failed.&#39;</span><span class="p">))</span> 


            <span class="k">try</span><span class="p">:</span>               
                <span class="c1"># Darstellungskoordinaten des Netzes bezogen auf untere linke Ecke == 0,0</span>
                <span class="n">vKnot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_KNOT&#39;</span><span class="p">]</span>            
                <span class="n">vKnotNet</span><span class="o">=</span><span class="n">vKnot</span><span class="p">[</span>    
                <span class="p">(</span><span class="n">vKnot</span><span class="p">[</span><span class="s1">&#39;ID_CONT&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">vKnot</span><span class="p">[</span><span class="s1">&#39;IDPARENT_CONT&#39;</span><span class="p">])</span>
                <span class="p">]</span>
                <span class="n">xMin</span><span class="o">=</span><span class="n">vKnotNet</span><span class="p">[</span><span class="s1">&#39;XKOR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
                <span class="n">yMin</span><span class="o">=</span><span class="n">vKnotNet</span><span class="p">[</span><span class="s1">&#39;YKOR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>            
                <span class="bp">self</span><span class="o">.</span><span class="n">nodeposDctNx</span><span class="o">=</span><span class="p">{</span><span class="n">name</span><span class="p">:(</span><span class="n">x</span><span class="o">-</span><span class="n">xMin</span>
                              <span class="p">,</span><span class="n">y</span><span class="o">-</span><span class="n">yMin</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vKnotNet</span><span class="p">[</span><span class="s1">&#39;NAME&#39;</span><span class="p">]</span>
                                                  <span class="p">,</span><span class="n">vKnotNet</span><span class="p">[</span><span class="s1">&#39;XKOR&#39;</span><span class="p">]</span>
                                                  <span class="p">,</span><span class="n">vKnotNet</span><span class="p">[</span><span class="s1">&#39;YKOR&#39;</span><span class="p">]</span>
                                                  <span class="p">)</span>
                <span class="p">}</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing NetworkX Graph G nodeposDctNx ok so far.&#39;</span><span class="p">))</span>    
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing NetworkX Graph G nodeposDctNx failed.&#39;</span><span class="p">))</span> 
               
            <span class="c1"># GSig</span>
                 
            <span class="k">if</span> <span class="s1">&#39;V3_RVBEL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>  
                <span class="n">df</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_RVBEL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Graph Signalmodell bauen</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">GSig</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="s1">&#39;Kn_i&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;Kn_k&#39;</span><span class="p">,</span> <span class="n">edge_attr</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">create_using</span><span class="o">=</span><span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">())</span>
                        <span class="n">nodeDct</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_RKNOT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
                        <span class="n">nodeDctNx</span><span class="o">=</span><span class="p">{</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;Kn&#39;</span><span class="p">]:</span><span class="n">value</span><span class="o">|</span><span class="p">{</span><span class="s1">&#39;idx&#39;</span><span class="p">:</span><span class="n">key</span><span class="p">}</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span><span class="n">value</span> <span class="ow">in</span> <span class="n">nodeDct</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
                        <span class="n">nx</span><span class="o">.</span><span class="n">set_node_attributes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GSig</span><span class="p">,</span><span class="n">nodeDctNx</span><span class="p">)</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing NetworkX Graph GSig ok so far.&#39;</span><span class="p">))</span>    
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing NetworkX Graph GSig failed.&#39;</span><span class="p">))</span>            
                                
            <span class="c1"># AGSN                        </span>
            <span class="k">try</span><span class="p">:</span>                                                        
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_AGSN</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_V3_AGSN</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dfAGSN</span><span class="p">)</span>                                                              
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing V3_AGSN failed.&#39;</span><span class="p">))</span>     

            <span class="k">try</span><span class="p">:</span>                                                                        
                <span class="c1"># Rohrvektoren </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">V3_AGSNVEC</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_V3_AGSNVEC</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_AGSN</span><span class="p">)</span><span class="c1">#.copy(deep=True))                            </span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing V3_AGSNVEC failed.&#39;</span><span class="p">))</span>                           
                                
        <span class="k">except</span> <span class="n">dxWithMxError</span><span class="p">:</span>
            <span class="k">raise</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span> 
            <span class="k">raise</span> <span class="n">dxWithMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                       
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;_Done.&#39;</span><span class="p">))</span>            


    <span class="k">def</span> <span class="nf">_V3_ROHRVEC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">V3_ROHR</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        V3_ROHRVEC: Expanding V3_ROHR to V3_ROHRVEC (includes interior points). V3_ROHRVEC is a dxWithMx object Attribute.</span>
<span class="sd">        </span>
<span class="sd">        :param V3_ROHR: dxWithMx Attribute</span>
<span class="sd">        :type V3_ROHR: df</span>
<span class="sd">        </span>
<span class="sd">        :return: V3_ROHRVEC</span>
<span class="sd">        :rtype: df        </span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            The interior points are defined by the output grid definition for pipes in the SIR 3S model. The numerical grid with which SIR 3S calculates is different from the output grid.</span>
<span class="sd">            The returned V3_ROHRVEC (one row per pipe and interior point) has the following columns:</span>
<span class="sd">                        </span>
<span class="sd">                - pk: Pipe-pk</span>
<span class="sd">                - tk: Pipe-tk                </span>
<span class="sd">                - ...</span>
<span class="sd">                - L</span>
<span class="sd">                - ...</span>
<span class="sd">                - NAME_i, NAME_k</span>
<span class="sd">                - mx2NofPts</span>
<span class="sd">                - dL (=L/(mx2NofPts-1))</span>
<span class="sd">                - ...</span>
<span class="sd">                - mx2Idx</span>
<span class="sd">                </span>
<span class="sd">                -  (&#39;STAT|TIME|TMIN|...&#39;,&#39;ROHR...QMAV|PHR|...&#39;, a Timestamp, a Timestamp): Pipe-Results</span>
<span class="sd">                </span>
<span class="sd">                - &quot;(&#39;STAT|TIME|TMIN|...&#39;,&#39;KNOT...PH|H|...&#39;,     a Timestamp, a Timestamp)&quot;_i: Pipe i-NODE Results</span>
<span class="sd">                - &quot;(&#39;STAT|TIME|TMIN|...&#39;,&#39;KNOT...PH|H|...&#39;,     a Timestamp, a Timestamp)&quot;_k: Pipe k-NODE Results</span>
<span class="sd">                </span>
<span class="sd">                - QMAVAbs: Pipes STAT QMAV-Result (absolute value)</span>
<span class="sd">                - VAVAbs: Pipes STAT VAV-Result (absolute value)</span>
<span class="sd">                - PHRAbs: Pipes STAT PHR-Result (absolute value)</span>
<span class="sd">                - JVAbs: Pipes STAT JV-Result (absolute value)</span>
<span class="sd">                </span>
<span class="sd">                - IptIdx: an Index of the points: S: Start (i-NODE), E: End (k-NODE), interior points: 0,1,2,... </span>
<span class="sd">                - IptIdxAsNo: an Index of the points starting with 0 at i-NODE: 0,1,2,...</span>
<span class="sd">                - IptIdxAsNoRev: an Index of the points starting with 0 at k-NODE: 0,1,2,...</span>
<span class="sd">                </span>
<span class="sd">                - SVEC: x in Edge-direction (IptIdx=S: 0.; IptIdx=E: L)</span>
<span class="sd">                - SVECRev (IptIdx=S: L; IptIdx=E: 0)</span>
<span class="sd">                - ZVEC: z</span>
<span class="sd">                </span>
<span class="sd">                - (&#39;STAT|TIME|TMIN|...&#39;,&#39;ROHR...MVEC|PVEC|RHOVEC|TVEC|...&#39;, a Timestamp, a Timestamp): point Results</span>
<span class="sd">                </span>
<span class="sd">                - (&#39;STAT|TIME|TMIN|...&#39;,&#39;manPVEC|mlcPVEC|barBzgPVEC|QMVEC|tMVEC|...&#39;,  a Timestamp, a Timestamp): point Results calculated by PT3S               </span>
<span class="sd">                                                </span>
<span class="sd">        &quot;&quot;&quot;</span>   
                
        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">Start.&quot;</span><span class="p">)</span> 
        
        <span class="k">try</span><span class="p">:</span> 
            <span class="k">pass</span>
                  
            <span class="n">vROHR</span><span class="o">=</span><span class="n">V3_ROHR</span>
            <span class="n">rVecMx2Idx</span><span class="o">=</span><span class="p">[]</span> 
            <span class="n">IptIdx</span><span class="o">=</span><span class="p">[]</span> 
            <span class="c1">#                annotieren in mx2Idx-Reihenfolge da die rVecs in mx2Idx-Reihenfolge geschrieben werden</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">vROHR</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;mx2Idx&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">itertuples</span><span class="p">():</span>
                            <span class="n">oneVecIdx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">mx2NofPts</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> 
                            <span class="n">oneVecIdx</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">mx2Idx</span><span class="p">)</span>                
                            <span class="n">rVecMx2Idx</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">oneVecIdx</span><span class="p">)</span>
                
                            <span class="n">oneLfdNrIdx</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">mx2NofPts</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>                    
                                <span class="n">oneLfdNrIdx</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">mx2NofPts</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
                            <span class="n">oneLfdNrIdx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
                            <span class="n">IptIdx</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">oneLfdNrIdx</span><span class="p">)</span>                    
            
            <span class="n">rVecChannels</span><span class="o">=</span><span class="p">[</span><span class="n">vec</span> <span class="k">for</span> <span class="n">vec</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="o">.</span><span class="n">dfVecAggs</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Mx</span><span class="o">.</span><span class="n">regExpSir3sRohrVecAttrType</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Mx</span><span class="o">.</span><span class="n">regExpSir3sVecID</span><span class="p">,</span><span class="n">vec</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ATTRTYPE&#39;</span><span class="p">))</span><span class="o">!=</span> <span class="kc">None</span><span class="p">]</span>                                                        
            <span class="n">dfrVecAggs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="o">.</span><span class="n">dfVecAggs</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">rVecChannels</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)),:]</span>
            <span class="n">dfrVecAggsT</span><span class="o">=</span><span class="n">dfrVecAggs</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">dfrVecAggsT</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">dfrVecAggsT</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_flat_index</span><span class="p">()</span>
            
            <span class="n">cols</span><span class="o">=</span><span class="n">dfrVecAggsT</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            
            <span class="c1">#rVecAggsT annotieren mit mx2Idx</span>
            <span class="n">dfrVecAggsT</span><span class="p">[</span><span class="s1">&#39;mx2Idx&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rVecMx2Idx</span>
            <span class="n">dfrVecAggsT</span><span class="p">[</span><span class="s1">&#39;IptIdx&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">IptIdx</span>                    
            <span class="n">dfrVecAggsT</span><span class="o">=</span><span class="n">dfrVecAggsT</span><span class="o">.</span><span class="n">filter</span><span class="p">([</span><span class="s1">&#39;mx2Idx&#39;</span><span class="p">,</span><span class="s1">&#39;IptIdx&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">cols</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="n">vROHR</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="p">,</span><span class="n">dfrVecAggsT</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;mx2Idx&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;mx2Idx&#39;</span><span class="p">)</span>
            
            <span class="c1"># 1 Spalte SVEC</span>
            <span class="n">rVecCols</span><span class="o">=</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">vROHR</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">col</span><span class="p">)</span><span class="o">==</span><span class="nb">tuple</span><span class="p">]</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Mx</span><span class="o">.</span><span class="n">regExpSir3sRohrVecAttrType</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">!=</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">t0rVec</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> </span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">))</span><span class="c1">#.%f&#39;))</span>
            <span class="n">SVEC</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span><span class="p">,</span>
              <span class="s1">&#39;ROHR~*~*~*~SVEC&#39;</span><span class="p">,</span>
              <span class="n">t0rVec</span><span class="p">,</span>
              <span class="n">t0rVec</span><span class="p">)</span>                    
            <span class="n">vROHR</span><span class="p">[</span><span class="s1">&#39;SVEC&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vROHR</span><span class="p">[</span><span class="n">SVEC</span><span class="p">]</span>
            <span class="n">sVecCols</span><span class="o">=</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rVecCols</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;SVEC$&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">!=</span><span class="kc">None</span><span class="p">]</span>
            <span class="c1"># andere SVEC-Spalten löschen</span>
            <span class="n">vROHR</span><span class="o">=</span><span class="n">vROHR</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">sVecCols</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>   
            <span class="n">vROHR</span><span class="p">[</span><span class="s1">&#39;SVECRev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vROHR</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;SVEC&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># 1 Spalte IptIdxAsNo</span>
            <span class="n">vROHR</span><span class="p">[</span><span class="s1">&#39;IptIdxAsNo&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vROHR</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tk&#39;</span><span class="p">])[</span><span class="s1">&#39;IptIdx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumcount</span><span class="p">()</span>
            <span class="c1"># 1 Spalte IptIdxAsNoRev</span>
            <span class="n">vROHR</span><span class="p">[</span><span class="s1">&#39;IptIdxAsNoRev&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vROHR</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;mx2NofPts&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;IptIdxAsNo&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># 1 Spalte ZVEC                    </span>
            <span class="n">ZVEC</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span><span class="p">,</span>
              <span class="s1">&#39;ROHR~*~*~*~ZVEC&#39;</span><span class="p">,</span>
              <span class="n">t0rVec</span><span class="p">,</span>
              <span class="n">t0rVec</span><span class="p">)</span>                    
            <span class="n">vROHR</span><span class="p">[</span><span class="s1">&#39;ZVEC&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">vROHR</span><span class="p">[</span><span class="n">ZVEC</span><span class="p">]</span>
            <span class="n">zVecCols</span><span class="o">=</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rVecCols</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;ZVEC$&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">!=</span><span class="kc">None</span><span class="p">]</span>
            <span class="c1"># andere ZVEC-Spalten löschen</span>
            <span class="n">vROHR</span><span class="o">=</span><span class="n">vROHR</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">zVecCols</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>         
                                                         
            <span class="c1"># Druecke und Fluesse in anderen Einheiten errechnen                    </span>
            <span class="n">pVecCols</span><span class="o">=</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rVecCols</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Mx</span><span class="o">.</span><span class="n">regExpSir3sVecID</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ATTRTYPE&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;PVEC&#39;</span><span class="p">,</span><span class="s1">&#39;PVECMIN_INST&#39;</span><span class="p">,</span><span class="s1">&#39;PVECMAX_INST&#39;</span><span class="p">]]</span>
            <span class="n">pVecs</span><span class="o">=</span><span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pVecCols</span><span class="p">]</span>
            <span class="n">pVecs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">pVecs</span><span class="p">))</span>
            
            <span class="n">mVecCols</span><span class="o">=</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rVecCols</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Mx</span><span class="o">.</span><span class="n">regExpSir3sVecID</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ATTRTYPE&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;MVEC&#39;</span><span class="p">]]</span>
            <span class="n">mVecs</span><span class="o">=</span><span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mVecCols</span><span class="p">]</span>
            <span class="n">mVecs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">mVecs</span><span class="p">))</span>
            
            <span class="n">rhoVecCols</span><span class="o">=</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rVecCols</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Mx</span><span class="o">.</span><span class="n">regExpSir3sVecID</span><span class="p">,</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ATTRTYPE&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;RHOVEC&#39;</span><span class="p">]]</span>
            
            <span class="n">pAtmosInBar</span><span class="o">=</span><span class="mf">1.</span><span class="c1">#0132</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;VIEW_MODELLE&#39;</span><span class="p">]</span>            
                <span class="n">vms</span><span class="o">=</span><span class="n">vm</span><span class="p">[</span><span class="n">vm</span><span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">QGISmodelXk</span><span class="p">])]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
                <span class="n">ATMO</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;ATMO&#39;</span><span class="p">]</span>
                <span class="n">pAtmosInBar</span><span class="o">=</span><span class="n">ATMO</span><span class="p">[</span><span class="n">ATMO</span><span class="p">[</span><span class="s1">&#39;fkDE&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">vms</span><span class="o">.</span><span class="n">fkBASIS</span><span class="p">][</span><span class="s1">&#39;PATMOS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">pAtmos konnte nicht ermittelt werden. pAtmos=1. wird verwendet.&quot;</span><span class="p">)</span>

            <span class="n">zBzg</span><span class="o">=</span><span class="mf">0.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">vm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;VIEW_MODELLE&#39;</span><span class="p">]</span>            
                <span class="n">vms</span><span class="o">=</span><span class="n">vm</span><span class="p">[</span><span class="n">vm</span><span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">QGISmodelXk</span><span class="p">])]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
                <span class="n">FWBZ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;FWBZ&#39;</span><span class="p">]</span>
                <span class="n">zBzg</span><span class="o">=</span><span class="n">FWBZ</span><span class="p">[</span><span class="n">FWBZ</span><span class="p">[</span><span class="s1">&#39;fkDE&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">vms</span><span class="o">.</span><span class="n">fkBASIS</span><span class="p">][</span><span class="s1">&#39;HGEBZG&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">zBzg konnte nicht ermittelt werden. zBzg=0. wird verwendet.&quot;</span><span class="p">)</span>
                    
            <span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="n">rhoVecCols</span><span class="p">:</span>
                
                <span class="k">for</span> <span class="n">pVec</span> <span class="ow">in</span> <span class="n">pVecs</span><span class="p">:</span>
                    <span class="n">col</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">pVec</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
                    <span class="n">pVecAttr</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Mx</span><span class="o">.</span><span class="n">regExpSir3sVecID</span><span class="p">,</span><span class="n">pVec</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ATTRTYPE&#39;</span><span class="p">)</span>
                    <span class="c1"># man</span>
                    <span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;man&#39;</span><span class="o">+</span><span class="n">pVecAttr</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">=</span><span class="n">vROHR</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="n">pAtmosInBar</span> 
                    <span class="c1"># mlc</span>
                    <span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;mlc&#39;</span><span class="o">+</span><span class="n">pVecAttr</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">=</span><span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;man&#39;</span><span class="o">+</span><span class="n">pVecAttr</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="p">(</span><span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">*</span><span class="mf">9.81</span><span class="p">)</span><span class="o">+</span><span class="n">vROHR</span><span class="p">[</span><span class="s1">&#39;ZVEC&#39;</span><span class="p">]</span>     
                    <span class="c1"># barBzg</span>
                    <span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;barBzg&#39;</span><span class="o">+</span><span class="n">pVecAttr</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">=</span><span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;man&#39;</span><span class="o">+</span><span class="n">pVecAttr</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span> <span class="o">+</span> <span class="p">(</span><span class="n">vROHR</span><span class="p">[</span><span class="s1">&#39;ZVEC&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">zBzg</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">*</span><span class="mf">9.81</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">5</span>
                    
                    
                <span class="k">for</span> <span class="n">mVec</span> <span class="ow">in</span> <span class="n">mVecs</span><span class="p">:</span>
                       <span class="n">col</span><span class="o">=</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">mVec</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
                       <span class="n">mVecAttr</span><span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Mx</span><span class="o">.</span><span class="n">regExpSir3sVecID</span><span class="p">,</span><span class="n">mVec</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;ATTRTYPE&#39;</span><span class="p">)</span>
                       <span class="c1"># m3/h</span>
                       <span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="o">+</span><span class="n">mVecAttr</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">=</span><span class="n">vROHR</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">/</span><span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">*</span><span class="mi">3600</span>
                       <span class="c1"># t/h</span>
                       <span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="o">+</span><span class="n">mVecAttr</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">=</span><span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="o">+</span><span class="n">mVecAttr</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">*</span><span class="n">vROHR</span><span class="p">[(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">d</span><span class="p">)]</span><span class="o">/</span><span class="mf">1000.</span>
            
            
            <span class="k">return</span> <span class="n">vROHR</span>            
            
                      
        <span class="k">except</span> <span class="n">dxWithMxError</span><span class="p">:</span>
            <span class="k">raise</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span> 
            <span class="k">raise</span> <span class="n">dxWithMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                       
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">_Done.&quot;</span><span class="p">)</span> 


    <span class="c1"># def _dfLAYR(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     dfLAYR: one row per LAYR and OBJ. dfLAYR is a dxWithMx object Attribute.</span>
                
    <span class="c1">#     .. note:: </span>
            
    <span class="c1">#         The returned dfLAYR (one row per LAYR and OBJ) has the following columns:</span>
                
    <span class="c1">#              LAYR:</span>
    <span class="c1">#                  - pk</span>
    <span class="c1">#                  - tk</span>
    <span class="c1">#                  - LFDNR (numeric)</span>
    <span class="c1">#                  - NAME</span>
                
    <span class="c1">#              LAYR-Info:</span>
    <span class="c1">#                  - AnzDerObjekteInGruppe</span>
    <span class="c1">#                  - AnzDerObjekteDesTypsInGruppe</span>
                
    <span class="c1">#              OBJ:</span>
    <span class="c1">#                  - TYPE</span>
    <span class="c1">#                  - ID</span>
                
    <span class="c1">#              OBJ-Info:</span>
    <span class="c1">#                  - NrDesObjektesDesTypsInGruppe</span>
    <span class="c1">#                  - NrDesObjektesInGruppe</span>
    <span class="c1">#                  - GruppenDesObjektsAnz</span>
    <span class="c1">#                  - GruppenDesObjektsNamen       </span>
                      
    <span class="c1">#     &quot;&quot;&quot;   </span>
                
    <span class="c1">#     logStr = &quot;{0:s}.{1:s}: &quot;.format(self.__class__.__name__, sys._getframe().f_code.co_name)</span>
    <span class="c1">#     logger.debug(f&quot;{logStr}Start.&quot;) </span>
        
    <span class="c1">#     try: </span>
    <span class="c1">#         dfLAYR=pd.DataFrame()</span>
    <span class="c1">#         dfLAYR=dxDecodeObjsData.Layr(self.dx)                                   </span>
    <span class="c1">#         return dfLAYR     </span>
    <span class="c1">#     except dxWithMxError:</span>
    <span class="c1">#         raise            </span>
    <span class="c1">#     except Exception as e:</span>
    <span class="c1">#         logStrFinal=&quot;{:s}Exception: Line: {:d}: {!s:s}: {:s}&quot;.format(logStr,sys.exc_info()[-1].tb_lineno,type(e),str(e))</span>
    <span class="c1">#         logger.debug(logStrFinal) </span>
    <span class="c1">#         raise dxWithMxError(logStrFinal)                       </span>
    <span class="c1">#     finally:</span>
    <span class="c1">#         logger.debug(f&quot;{logStr}_Done.&quot;) </span>


    <span class="k">def</span> <span class="nf">_gdfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create gdfs from V3-dfs.</span>
<span class="sd">        </span>
<span class="sd">        :param crs: (=coordinate reference system) Determines crs used in the geopandas-Dfs (Possible value:&#39;EPSG:25832&#39;). If None, crs will be read from SIR 3S&#39; database file.</span>
<span class="sd">        :type crs: str, optional, default=None  </span>
<span class="sd">        </span>
<span class="sd">        :return: (gdf_FWVB, gdf_ROHR, gdf_KNOT)</span>
<span class="sd">        :rtype: tuple of gdfs         </span>

<span class="sd">        .. note:: </span>
<span class="sd">            V3_FWVB, V3_ROHR, V3_KNOT and gdf_FWVB, gdf_ROHR, gdf_KNOT are dxWithMx object Attributes.</span>
<span class="sd">            </span>
<span class="sd">                - V3_FWVB: gdf_FWVB</span>
<span class="sd">                - V3_ROHR: gdf_ROHR</span>
<span class="sd">                - V3_KNOT: gdf_KNOT                </span>
<span class="sd">        &quot;&quot;&quot;</span>   
                
        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">Start.&quot;</span><span class="p">)</span> 
        
        <span class="k">try</span><span class="p">:</span>
            
            <span class="n">gdf_FWVB</span><span class="o">=</span><span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">()</span>
            <span class="n">gdf_ROHR</span><span class="o">=</span><span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">()</span>
            <span class="n">gdf_KNOT</span><span class="o">=</span><span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">crs</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>               
                    <span class="n">dfSG</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;SIRGRAF&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="s1">&#39;SRID2&#39;</span> <span class="ow">in</span> <span class="n">dfSG</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="n">dfSG</span><span class="p">[</span><span class="s1">&#39;SRID2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">crs</span> <span class="o">=</span> <span class="s1">&#39;EPSG:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dfSG</span><span class="p">[</span><span class="s1">&#39;SRID2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">crs</span> <span class="o">=</span> <span class="s1">&#39;EPSG:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dfSG</span><span class="p">[</span><span class="s1">&#39;SRID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2"> </span><span class="si">{2:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span> <span class="s1">&#39;crs reading successful: &#39;</span><span class="p">,</span> <span class="n">crs</span><span class="p">))</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;crs reading failed.&#39;</span><span class="p">))</span>  
                    <span class="c1">#crs=&#39;EPSG:4326&#39;</span>
                    <span class="c1">#logger.debug(&quot;{0:s}crs used: {1:s}&quot;.format(logStr,crs))  </span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2"> </span><span class="si">{2:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span> <span class="s1">&#39;crs given value used: &#39;</span><span class="p">,</span> <span class="n">crs</span><span class="p">))</span>
            
            <span class="k">try</span><span class="p">:</span>
                                            
                <span class="n">gs</span><span class="o">=</span><span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="o">.</span><span class="n">from_wkb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_FWVB</span><span class="p">[</span><span class="s1">&#39;GEOMWKB&#39;</span><span class="p">],</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
                <span class="n">gdf_FWVB</span><span class="o">=</span><span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_FWVB</span><span class="p">,</span><span class="n">geometry</span><span class="o">=</span><span class="n">gs</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
            
                <span class="n">gs</span><span class="o">=</span><span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="o">.</span><span class="n">from_wkb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="p">[</span><span class="s1">&#39;GEOMWKB&#39;</span><span class="p">],</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
                <span class="n">gdf_ROHR</span><span class="o">=</span><span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="p">,</span><span class="n">geometry</span><span class="o">=</span><span class="n">gs</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
                
                <span class="n">gs</span><span class="o">=</span><span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="o">.</span><span class="n">from_wkb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_KNOT</span><span class="p">[</span><span class="s1">&#39;GEOMWKB&#39;</span><span class="p">],</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
                <span class="n">gdf_KNOT</span><span class="o">=</span><span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_KNOT</span><span class="p">,</span><span class="n">geometry</span><span class="o">=</span><span class="n">gs</span><span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>
                
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of gdfs ok so far.&quot;</span><span class="p">))</span>  
                
            
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing of (some) gdfs failed.&#39;</span><span class="p">))</span>
            
            <span class="k">return</span><span class="p">(</span><span class="n">gdf_FWVB</span><span class="p">,</span><span class="n">gdf_ROHR</span><span class="p">,</span><span class="n">gdf_KNOT</span><span class="p">)</span>
    
  
        <span class="k">except</span> <span class="n">dxWithMxError</span><span class="p">:</span>
            <span class="k">raise</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span> 
            <span class="k">raise</span> <span class="n">dxWithMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                       
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">_Done.&quot;</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">_V3_KNOT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df_V3_KNOT</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        V3_KNOT is a m object Attribute.</span>
<span class="sd">        </span>
<span class="sd">        :param df_V3_KNOT: V3sErg[&#39;V3_KNOT&#39;] from dx.MxAdd(mx) </span>
<span class="sd">        :type df_V3_VKNOT: df</span>
<span class="sd">        </span>
<span class="sd">        :return df_V3_VKNOT: df_V3_KNOT expanded</span>
<span class="sd">        :type df_V3_KNOT: df        </span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            KNOT is the German abbreviation for Nodes (defined in the SIR 3S model).</span>
<span class="sd">            In the returned V3_KNOT (one row per Edge) the following columns are added:</span>
<span class="sd">                      </span>
<span class="sd">                - PH: STAT PH-result (i.e. bar) </span>
<span class="sd">                - dPH: STAT (PHSL-PHRL)-result if Node-Partner is defined (i.e. bar) </span>
<span class="sd">        &quot;&quot;&quot;</span>   
                
        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">Start.&quot;</span><span class="p">)</span> 
        
        <span class="k">try</span><span class="p">:</span> 
                    
            <span class="n">t0</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> </span><span class="si">%X</span><span class="s1">.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">))</span>
            

            
            <span class="k">try</span><span class="p">:</span>                                                         
                 <span class="n">PH</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span>
                             <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~PH&#39;</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">)</span>
                 <span class="n">df_V3_KNOT</span><span class="p">[</span><span class="s1">&#39;PH&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_KNOT</span><span class="p">[</span><span class="n">PH</span><span class="p">]</span>      
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_KNOT[&#39;PH&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col PH in V3_KNOT failed.&#39;</span><span class="p">))</span>    
               
            <span class="k">try</span><span class="p">:</span>                                                         
                 <span class="n">dPH</span><span class="o">=</span><span class="s1">&#39;dPH&#39;</span>
                 <span class="k">def</span> <span class="nf">getdPH</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">df_V3_KNOT</span><span class="p">):</span>
                     
                     <span class="n">df</span><span class="o">=</span><span class="n">df_V3_KNOT</span><span class="p">[</span><span class="n">df_V3_KNOT</span><span class="p">[</span><span class="s1">&#39;tk&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;fk2LKNOT&#39;</span><span class="p">]]</span>
                     <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                         <span class="k">return</span> <span class="kc">None</span>
                     <span class="n">s</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                     <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;KVR&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;1.&#39;</span><span class="p">]:</span>
                         <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;PH&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">s</span><span class="o">.</span><span class="n">PH</span>
                     <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;KVR&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;2.&#39;</span><span class="p">]:</span>
                         <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;PH&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">s</span><span class="o">.</span><span class="n">PH</span><span class="p">)</span>
                     <span class="k">else</span><span class="p">:</span>
                         <span class="k">return</span> <span class="kc">None</span>
                         
                 <span class="n">df_V3_KNOT</span><span class="p">[</span><span class="n">dPH</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>   
                 <span class="n">df_V3_KNOT</span><span class="p">[</span><span class="n">dPH</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_KNOT</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">getdPH</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">df_V3_KNOT</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">Constructing of V3_KNOT[dPH] ok so far: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">df_V3_KNOT</span><span class="p">[</span><span class="n">dPH</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col dPH in V3_KNOT failed.&#39;</span><span class="p">))</span>      
               
            <span class="k">return</span> <span class="n">df_V3_KNOT</span>   
        <span class="k">except</span> <span class="n">dxWithMxError</span><span class="p">:</span>
            <span class="k">raise</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span> 
            <span class="k">raise</span> <span class="n">dxWithMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                       
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">_Done.&quot;</span><span class="p">)</span> 
            
    <span class="k">def</span> <span class="nf">_V3_VBEL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df_V3_VBEL</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        V3_VBEL is a m object Attribute.</span>
<span class="sd">        </span>
<span class="sd">        :param df_V3_VBEL: V3sErg[&#39;V3_VBEL&#39;] from dx.MxAdd(mx) </span>
<span class="sd">        :type df_V3_VBEL: df</span>
<span class="sd">        </span>
<span class="sd">        :return df_V3_VBEL: df_V3_VBEL expanded</span>
<span class="sd">        :type df_V3_VBEL: df        </span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            VBEL is the German abbreviation for Edges (defined in the SIR 3S model).</span>
<span class="sd">            In the returned V3_VBEL (one row per Edge) the following columns are added:</span>
<span class="sd">                      </span>
<span class="sd">                - PH_i,_k: STAT PH-result (i.e. bar) </span>
<span class="sd">                - H_i,_k: STAT H-result (i.e. barBzg) </span>
<span class="sd">                - mlc_i,_k: STAT H-result </span>
<span class="sd">                - RHO_i,_k: STAT RHO-result </span>
<span class="sd">                - T_i,_k: STAT T-result </span>
<span class="sd">                - QM: STAT QM-Result </span>
<span class="sd">        &quot;&quot;&quot;</span>   
                
        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">Start.&quot;</span><span class="p">)</span> 
        
        <span class="k">try</span><span class="p">:</span> 
                    
            <span class="k">try</span><span class="p">:</span>                                    
                 <span class="n">t0</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> </span><span class="si">%X</span><span class="s1">.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">))</span>
                 <span class="n">QM</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span>
                             <span class="p">,</span><span class="s1">&#39;QM&#39;</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">)</span>
                 <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;QM&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">QM</span><span class="p">]</span>      
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;QM&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col QM in V3_VBEL failed.&#39;</span><span class="p">))</span>   
                 
            <span class="k">try</span><span class="p">:</span>                                                         
                 <span class="n">PH_i</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                             <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~PH&#39;</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_i&#39;</span>
                 <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;PH_i&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">PH_i</span><span class="p">]</span>      
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;PH_i&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col PH_i in V3_VBEL failed.&#39;</span><span class="p">))</span>    
                 
            <span class="k">try</span><span class="p">:</span>                                                         
                 <span class="n">PH_k</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                             <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~PH&#39;</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_k&#39;</span>
                 <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;PH_k&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">PH_k</span><span class="p">]</span>      
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;PH_k&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col PH_k in V3_VBEL failed.&#39;</span><span class="p">))</span>                         
 
              
            <span class="k">try</span><span class="p">:</span>                                                         
                 <span class="n">T_i</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                             <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~T&#39;</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_i&#39;</span>
                 <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;T_i&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">T_i</span><span class="p">]</span>      
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;T_i&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col T_i in V3_VBEL failed.&#39;</span><span class="p">))</span>     
                 
            <span class="k">try</span><span class="p">:</span>                                                         
                 <span class="n">T_k</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                             <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~T&#39;</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_k&#39;</span>
                 <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;T_k&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">T_k</span><span class="p">]</span>      
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;T_k&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col T_k in V3_VBEL failed.&#39;</span><span class="p">))</span>                          
    

            <span class="k">try</span><span class="p">:</span>                                                         
                 <span class="n">H_i</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                             <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~H&#39;</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_i&#39;</span>
                 <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;H_i&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">H_i</span><span class="p">]</span>      
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;H_i&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col H_i in V3_VBEL failed.&#39;</span><span class="p">))</span>    
                 
            <span class="k">try</span><span class="p">:</span>                                                         
                 <span class="n">H_k</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                             <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~H&#39;</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">,</span><span class="n">t0</span>
                             <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_k&#39;</span>
                 <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;H_k&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">H_k</span><span class="p">]</span>      
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;H_k&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                 <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                 <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col H_k in V3_VBEL failed.&#39;</span><span class="p">))</span>                
                 
            <span class="k">try</span><span class="p">:</span>                                                         
                <span class="n">RHO_i</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                            <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~RHO&#39;</span>
                            <span class="p">,</span><span class="n">t0</span>
                            <span class="p">,</span><span class="n">t0</span>
                            <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_i&#39;</span>
                <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;RHO_i&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">RHO_i</span><span class="p">]</span>      
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;RHO_i&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col RHO_i in V3_VBEL failed.&#39;</span><span class="p">))</span>    
                
            <span class="k">try</span><span class="p">:</span>                                                         
                <span class="n">RHO_k</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                            <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~RHO&#39;</span>
                            <span class="p">,</span><span class="n">t0</span>
                            <span class="p">,</span><span class="n">t0</span>
                            <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_k&#39;</span>
                <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;RHO_k&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">RHO_k</span><span class="p">]</span>      
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;RHO_k&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col RHO_k in V3_VBEL failed.&#39;</span><span class="p">))</span>                                     
                 
            <span class="k">try</span><span class="p">:</span>                                                                             
                <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;mlc_i&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">PH_i</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="p">(</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">RHO_i</span><span class="p">]</span><span class="o">*</span><span class="mf">9.81</span><span class="p">)</span><span class="o">+</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;ZKOR_i&#39;</span><span class="p">]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;mlc_i&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col mlc_i in V3_VBEL failed.&#39;</span><span class="p">))</span>    
                
            <span class="k">try</span><span class="p">:</span>                                                                             
                <span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;mlc_k&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">PH_k</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="p">(</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="n">RHO_k</span><span class="p">]</span><span class="o">*</span><span class="mf">9.81</span><span class="p">)</span><span class="o">+</span><span class="n">df_V3_VBEL</span><span class="p">[</span><span class="s1">&#39;ZKOR_k&#39;</span><span class="p">]</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_VBEL[&#39;mlc_k&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col mlc_k in V3_VBEL failed.&#39;</span><span class="p">))</span>                        
                                                                           
                              
            <span class="k">return</span> <span class="n">df_V3_VBEL</span>   
        <span class="k">except</span> <span class="n">dxWithMxError</span><span class="p">:</span>
            <span class="k">raise</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span> 
            <span class="k">raise</span> <span class="n">dxWithMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                       
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">_Done.&quot;</span><span class="p">)</span> 
            
    <span class="k">def</span> <span class="nf">_V3_FWVB</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">df_V3_FWVB</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        V3_FWVB is a m object Attribute.</span>
<span class="sd">        </span>
<span class="sd">        :param df_V3_FWVB: V3sErg[&#39;V3_FWVB&#39;] from dx.MxAdd(mx) </span>
<span class="sd">        :type df_V3_FWVB: df</span>
<span class="sd">        </span>
<span class="sd">        :return df_V3_FWVB: df_V3_FWVB expanded</span>
<span class="sd">        :type df_V3_FWVB: df        </span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            FWVB is the German abbreviation for District Heating House Stations (defined in the SIR 3S model).</span>
<span class="sd">            In the returned V3_FWVB (one row per FWVB) the following columns are added:</span>
<span class="sd">                      </span>
<span class="sd">                - W: STAT W-Result </span>
<span class="sd">                - QM: STAT QM-Result </span>
<span class="sd">                - T_i,_k: STAT T-result  </span>
<span class="sd">                - PH_i,_k: STAT PH-result (i.e. bar)                 </span>
<span class="sd">        &quot;&quot;&quot;</span>   
                
        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">Start.&quot;</span><span class="p">)</span> 
        
        <span class="k">try</span><span class="p">:</span> 
            
            <span class="c1"># FWVB</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">df_V3_FWVB</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                
                <span class="n">t0</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> </span><span class="si">%X</span><span class="s1">.</span><span class="si">%f</span><span class="s1">&#39;</span><span class="p">))</span>
                
                <span class="k">try</span><span class="p">:</span>                                                         
                     <span class="n">W</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;FWVB~*~*~*~W&#39;</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">)</span>
                     <span class="n">df_V3_FWVB</span><span class="p">[</span><span class="s1">&#39;W&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_FWVB</span><span class="p">[</span><span class="n">W</span><span class="p">]</span>
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_FWVB[&#39;W&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                     <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col W in V3_FWVB failed.&#39;</span><span class="p">))</span>   
                     
                <span class="k">try</span><span class="p">:</span>                                             
                     <span class="n">QM</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;FWVB~*~*~*~QM&#39;</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">)</span>
                     <span class="n">df_V3_FWVB</span><span class="p">[</span><span class="s1">&#39;QM&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_FWVB</span><span class="p">[</span><span class="n">QM</span><span class="p">]</span>
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_FWVB[&#39;QM&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                     <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col QM in V3_FWVB failed.&#39;</span><span class="p">))</span>     
                     
                     
                <span class="k">try</span><span class="p">:</span>                                                         
                     <span class="n">PH_i</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~PH&#39;</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_i&#39;</span>
                     <span class="n">df_V3_FWVB</span><span class="p">[</span><span class="s1">&#39;PH_i&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_FWVB</span><span class="p">[</span><span class="n">PH_i</span><span class="p">]</span>      
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_FWVB[&#39;PH_i&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                     <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col PH_i in V3_FWVB failed.&#39;</span><span class="p">))</span>    
                     
                <span class="k">try</span><span class="p">:</span>                                                         
                     <span class="n">PH_k</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~PH&#39;</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_k&#39;</span>
                     <span class="n">df_V3_FWVB</span><span class="p">[</span><span class="s1">&#39;PH_k&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_FWVB</span><span class="p">[</span><span class="n">PH_k</span><span class="p">]</span>      
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_FWVB[&#39;PH_k&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                     <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col PH_k in V3_FWVB failed.&#39;</span><span class="p">))</span>                         
     
                  
                <span class="k">try</span><span class="p">:</span>                                                         
                     <span class="n">T_i</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~T&#39;</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_i&#39;</span>
                     <span class="n">df_V3_FWVB</span><span class="p">[</span><span class="s1">&#39;T_i&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_FWVB</span><span class="p">[</span><span class="n">T_i</span><span class="p">]</span>      
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_FWVB[&#39;T_i&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                     <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col T_i in V3_FWVB failed.&#39;</span><span class="p">))</span>     
                     
                <span class="k">try</span><span class="p">:</span>                                                         
                     <span class="n">T_k</span><span class="o">=</span><span class="nb">str</span><span class="p">((</span><span class="s1">&#39;STAT&#39;</span>
                                 <span class="p">,</span><span class="s1">&#39;KNOT~*~*~*~T&#39;</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">,</span><span class="n">t0</span>
                                 <span class="p">))</span><span class="o">+</span><span class="s1">&#39;_k&#39;</span>
                     <span class="n">df_V3_FWVB</span><span class="p">[</span><span class="s1">&#39;T_k&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">df_V3_FWVB</span><span class="p">[</span><span class="n">T_k</span><span class="p">]</span>      
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s2">&quot;Constructing of V3_FWVB[&#39;T_k&#39;] ok so far.&quot;</span><span class="p">))</span>                                                      
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                     <span class="n">logStrTmp</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrTmp</span><span class="p">)</span> 
                     <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Constructing col T_k in V3_FWVB failed.&#39;</span><span class="p">))</span>                            
                     
                     
                <span class="c1"># try:     </span>
                <span class="c1">#      TI=(&#39;STAT&#39;</span>
                <span class="c1">#                  ,&#39;FWVB~*~*~*~TI&#39;</span>
                <span class="c1">#                  ,t0</span>
                <span class="c1">#                  ,t0</span>
                <span class="c1">#                  )</span>
                <span class="c1">#      df_V3_FWVB[&#39;TI&#39;]=df_V3_FWVB[TI]</span>
                <span class="c1">#      logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&quot;Constructing of V3_FWVB[&#39;TI&#39;] ok so far.&quot;))                                                      </span>
                <span class="c1"># except Exception as e:</span>
                <span class="c1">#      logStrTmp=&quot;{:s}Exception: Line: {:d}: {!s:s}: {:s}&quot;.format(logStr,sys.exc_info()[-1].tb_lineno,type(e),str(e))</span>
                <span class="c1">#      logger.debug(logStrTmp) </span>
                <span class="c1">#      logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&#39;Constructing col TI in V3_FWVB failed.&#39;))    </span>

                <span class="c1"># try:     </span>
                <span class="c1">#      TK=(&#39;STAT&#39;</span>
                <span class="c1">#                  ,&#39;FWVB~*~*~*~TK&#39;</span>
                <span class="c1">#                  ,t0</span>
                <span class="c1">#                  ,t0</span>
                <span class="c1">#                  )</span>
                <span class="c1">#      df_V3_FWVB[&#39;TK&#39;]=df_V3_FWVB[TK]</span>
                <span class="c1">#      logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&quot;Constructing of V3_FWVB[&#39;TK&#39;] ok so far.&quot;))                                                      </span>
                <span class="c1"># except Exception as e:</span>
                <span class="c1">#      logStrTmp=&quot;{:s}Exception: Line: {:d}: {!s:s}: {:s}&quot;.format(logStr,sys.exc_info()[-1].tb_lineno,type(e),str(e))</span>
                <span class="c1">#      logger.debug(logStrTmp) </span>
                <span class="c1">#      logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&#39;Constructing col TK in V3_FWVB failed.&#39;))               </span>
            
            <span class="k">return</span> <span class="n">df_V3_FWVB</span>   
        <span class="k">except</span> <span class="n">dxWithMxError</span><span class="p">:</span>
            <span class="k">raise</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span> 
            <span class="k">raise</span> <span class="n">dxWithMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                       
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">_Done.&quot;</span><span class="p">)</span> 


    <span class="k">def</span> <span class="nf">_V3_AGSN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dfAGSN</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        V3_AGSN is a m object Attribute.</span>
<span class="sd">        </span>
<span class="sd">        :param dfAGSN: dx.dfAGSN</span>
<span class="sd">        :type dfAGSN: df</span>
<span class="sd">        </span>
<span class="sd">        :return: V3_AGSN: dfAGSN expanded to V3_AGSN</span>
<span class="sd">        :rtype: df        </span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            AGSN is the German abbreviation for longitudinal sections / cuts (defined in the SIR 3S model).</span>
<span class="sd">            The returned V3_AGSN (one row per Edge in (Section,Layer)) has the following columns:</span>
<span class="sd">        </span>
<span class="sd">                - Pos: Position of Edge in (Section,Layer) starting with 0; Pos=-1: startNODE-row (same index as Pos=0 row)</span>
<span class="sd">                - pk: Section-pk</span>
<span class="sd">                - tk: Section-tk</span>
<span class="sd">                - LFDNR: Section-LFDNR (numeric)</span>
<span class="sd">                - NAME: Section-Name</span>
<span class="sd">                - XL: Section-Layer:  0: everything; 1: SL (the stuff before BLn in SIR 3S BLOB); 2: RL (the stuff after BLn in SIR 3S BLOB)     </span>
<span class="sd">                - compNr: Number of the connected Component in (Section,Layer) starting with 1</span>
<span class="sd">                - nextNODE: Name of the next Node in cut-direction reached by the Edge (startNODE-Name for Pos=-1)</span>
<span class="sd">                </span>
<span class="sd">                - OBJTYPE: Edge-Type</span>
<span class="sd">                - OBJID: Edge-ID</span>
<span class="sd">                </span>
<span class="sd">                - L (0 for Pos=-1)</span>
<span class="sd">                - DN</span>
<span class="sd">                - Am2</span>
<span class="sd">                - Vm3</span>
<span class="sd">                </span>
<span class="sd">                - NAME_CONT</span>
<span class="sd">                - NAME_i</span>
<span class="sd">                - NAME_k</span>
<span class="sd">                </span>
<span class="sd">                - ZKOR_n: nextNODEs ZKOR</span>
<span class="sd">                - BESCHREIBUNG_n: nextNODEs BESCHREIBUNG</span>
<span class="sd">                - KVR_n: nextNODEs KVR</span>
<span class="sd">                </span>
<span class="sd">                - LSum: cumulated L up to nextNODE</span>
<span class="sd">                - direction: XL=0,1: 1 if edge defined in cut-direction, otherwise -1; XL=2: 1 if edge defined in reverse cut-direction, otherwise -1 </span>
<span class="sd">                </span>
<span class="sd">                - corresponding to the V3_VBEL attributes:</span>
<span class="sd">                    </span>
<span class="sd">                - PH_n: nextNODEs STAT PH-result (i.e. bar) (startNODEs result for Pos=-1)</span>
<span class="sd">                - H_n: nextNODEs STAT H-result (i.e. barBzg) (startNODEs result for Pos=-1)</span>
<span class="sd">                - mlc_n: nextNODEs STAT H-result (startNODEs result for Pos=-1) </span>
<span class="sd">                - RHO_n: nextNODEs STAT RHO-result (startNODEs result for Pos=-1)</span>
<span class="sd">                - T_n: nextNODEs STAT T-result (startNODEs result for Pos=-1)                 </span>
<span class="sd">                - QM: Egde STAT QM-Result (startNODEs result for Pos=-1)</span>
<span class="sd">                </span>
<span class="sd">                -  (&#39;STAT|TIME|TMIN|...&#39;,&#39;QM&#39;, a Timestamp, a Timestamp): Egde QM-Results</span>
<span class="sd">                </span>
<span class="sd">                - &quot;(&#39;STAT|TIME|TMIN|...&#39;,&#39;KNOT...PH|H|...&#39;, a Timestamp, a Timestamp)&quot;_n: nextNODEs Results</span>
<span class="sd">                </span>
<span class="sd">                - &quot;(&#39;STAT|TIME|TMIN|...&#39;,&#39;mlc|...&#39;        , a Timestamp, a Timestamp)&quot;_n: nextNODEs Results calculated by PT3S </span>
<span class="sd">                </span>
<span class="sd">                    </span>
<span class="sd">                </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>   
                
        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">Start.&quot;</span><span class="p">)</span> 
        
        <span class="k">try</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">dfAGSN</span><span class="p">[</span><span class="o">~</span><span class="n">dfAGSN</span><span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2"> dfAGSN empty.&quot;</span><span class="p">)</span> 
                <span class="k">return</span> <span class="n">dfAGSN</span>
        
            <span class="n">dfAGSN</span><span class="o">=</span><span class="n">constructNewMultiindexFromCols</span><span class="p">(</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span><span class="n">mColNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;TYPE&#39;</span><span class="p">,</span><span class="s1">&#39;ID&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">,</span><span class="s1">&#39;XL&#39;</span><span class="p">,</span><span class="s1">&#39;Pos&#39;</span><span class="p">])</span>
            <span class="c1"># urspruengliche Cols</span>
            <span class="n">colsAGSNBase</span><span class="o">=</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            
            <span class="n">dfAGSN</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dfAGSN</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_VBEL</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_VBEL&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">,</span><span class="s1">&#39;XL&#39;</span><span class="p">,</span><span class="s1">&#39;Pos&#39;</span><span class="p">])</span>
            
            <span class="n">cols</span><span class="o">=</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="n">colsErg</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;mx2Idx&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            
            <span class="n">colsVBELBase</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OBJTYPE&#39;</span><span class="p">,</span><span class="s1">&#39;OBJID&#39;</span><span class="p">,</span>
                          <span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;DN&#39;</span><span class="p">,</span><span class="s1">&#39;Am2&#39;</span><span class="p">,</span><span class="s1">&#39;Vm3&#39;</span><span class="p">,</span><span class="s1">&#39;NAME_CONT&#39;</span><span class="p">,</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">,</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">]</span>
            
            <span class="n">dfAGSN</span><span class="o">=</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">colsAGSNBase</span><span class="c1">#.to_list()</span>
                                 <span class="o">+</span><span class="n">colsVBELBase</span>
                                 <span class="o">+</span><span class="p">[</span><span class="s1">&#39;ZKOR_i&#39;</span><span class="p">,</span><span class="s1">&#39;ZKOR_k&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;BESCHREIBUNG_i&#39;</span><span class="p">,</span><span class="s1">&#39;BESCHREIBUNG_k&#39;</span>
                                  <span class="p">,</span><span class="s1">&#39;KVR_i&#39;</span><span class="p">,</span><span class="s1">&#39;KVR_k&#39;</span>
                                  <span class="p">]</span>
                                 <span class="o">+</span><span class="n">colsErg</span><span class="p">)</span>
            
            
            <span class="c1"># Sachspalten _i,_k</span>
            <span class="n">colsSach_i</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ZKOR_i&#39;</span><span class="p">,</span><span class="s1">&#39;BESCHREIBUNG_i&#39;</span><span class="p">,</span><span class="s1">&#39;KVR_i&#39;</span><span class="p">]</span>
            <span class="n">colsSach_k</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ZKOR_k&#39;</span><span class="p">,</span><span class="s1">&#39;BESCHREIBUNG_k&#39;</span><span class="p">,</span><span class="s1">&#39;KVR_k&#39;</span><span class="p">]</span>
            
            <span class="c1"># ob VBEL in Schnittrichtung definiert anlegen</span>
            <span class="n">dfAGSN</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span>
             
            <span class="c1"># zugeh. Sachspalten _n anlegen</span>
            <span class="n">colsSach_n</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">col_i</span><span class="p">,</span><span class="n">col_k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colsSach_i</span><span class="p">,</span><span class="n">colsSach_k</span><span class="p">):</span>
                <span class="n">col_n</span><span class="o">=</span><span class="n">col_i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_i&#39;</span><span class="p">,</span><span class="s1">&#39;_n&#39;</span><span class="p">)</span>
                <span class="c1">#print(col_n)</span>
                <span class="n">dfAGSN</span><span class="p">[</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
                <span class="n">colsSach_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_n</span><span class="p">)</span>                  
             
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">dfAGSN.columns.to_list(): zugeh. Sachspalten _n angelegt: </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">colsSach_n</span><span class="p">)))</span>       
                        
            <span class="c1"># Ergebnisspalten _i,_k</span>
            <span class="n">colsErg_i</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">colsErg</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;_i$&#39;</span><span class="p">,</span><span class="n">col</span><span class="p">)]</span>
            <span class="n">colsErg_k</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">colsErg</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;_k$&#39;</span><span class="p">,</span><span class="n">col</span><span class="p">)]</span>
            
            <span class="c1"># zugeh. Ergebnisspalten _n anlegen</span>
            <span class="n">colsErg_n</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">col_i</span><span class="p">,</span><span class="n">col_k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colsErg_i</span><span class="p">,</span><span class="n">colsErg_k</span><span class="p">):</span>
                <span class="n">col_n</span><span class="o">=</span><span class="n">col_i</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_i&#39;</span><span class="p">,</span><span class="s1">&#39;_n&#39;</span><span class="p">)</span>
                <span class="c1">#print(col_n)</span>
                <span class="n">dfAGSN</span><span class="p">[</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>
                <span class="n">colsErg_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col_n</span><span class="p">)</span>  
                                
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">dfAGSN.columns.to_list(): zugeh. Ergspalten _n angelegt: </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">colsErg_n</span><span class="p">)))</span>       
            
            <span class="c1">#logger.debug(&quot;{0:s}dfAGSN.columns.to_list(): {1:s}&quot;.format(logStr,str(dfAGSN.columns.to_list())))       </span>
                            
            <span class="n">dfAGSN</span><span class="o">=</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;level_0&#39;</span><span class="p">:</span><span class="s1">&#39;OBJTYPE&#39;</span><span class="p">,</span><span class="s1">&#39;level_1&#39;</span><span class="p">:</span><span class="s1">&#39;OBJID&#39;</span><span class="p">})</span>
            
            <span class="c1">#logger.debug(&quot;{0:s}dfAGSN.columns.to_list(): {1:s}&quot;.format(logStr,str(dfAGSN.columns.to_list())))</span>
            
            <span class="c1"># Schnittrichtung bestücken; Ergebnisspalten und Sachspalten nach Schnittrichtung bestücken</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dfAGSN</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">]:</span>
                            <span class="k">pass</span>
                        <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">]:</span>                            
                            <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span> <span class="c1"># VL-Fluss von links nach rechts (in Schnittr.) pos. def. aber VBEL von rechts nach links</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">]:</span>
                            <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span> <span class="c1"># RL-Fluss von rechts nach links (entgegen Schnittr.) pos. def. aber VBEL von links nach rechts</span>
                        <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">]:</span>                            
                            <span class="k">pass</span>
                                        
                    <span class="k">for</span> <span class="n">col_n</span><span class="p">,</span><span class="n">col_i</span><span class="p">,</span><span class="n">col_k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colsErg_n</span><span class="p">,</span><span class="n">colsErg_i</span><span class="p">,</span><span class="n">colsErg_k</span><span class="p">):</span>        
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_k</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_i</span><span class="p">]</span>   
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_k</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_i</span><span class="p">]</span>                                   
                            
                            
                    <span class="c1">#logger.debug(f&quot;{logStr} {row[&#39;NAME_i&#39;]} {row[&#39;NAME_k&#39;]} {dfAGSN.loc[index,&#39;direction&#39;]} PH_i={row[&#39;PH_i&#39;]} PH_k={row[&#39;PH_k&#39;]} PH_n={dfAGSN.loc[index,&#39;PH_n&#39;]} mlc_i={row[&#39;mlc_i&#39;]} mlc_k={row[&#39;mlc_k&#39;]} mlc_n={dfAGSN.loc[index,&#39;mlc_n&#39;]} &quot;) </span>
                            
                    <span class="k">for</span> <span class="n">col_n</span><span class="p">,</span><span class="n">col_i</span><span class="p">,</span><span class="n">col_k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colsSach_n</span><span class="p">,</span><span class="n">colsSach_i</span><span class="p">,</span><span class="n">colsSach_k</span><span class="p">):</span>    
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_k</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_i</span><span class="p">]</span>   
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                                <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_k</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_i</span><span class="p">]</span>                                  
                        
                        
                        <span class="c1">#if dfAGSN.loc[index,&#39;direction&#39;]==1:                                </span>
                        <span class="c1">#    dfAGSN.loc[index,col_n]= row[col_k]</span>
                        <span class="c1">#else:</span>
                        <span class="c1">#    dfAGSN.loc[index,col_n]= row[col_i]  </span>
                                                                                    
            <span class="c1"># am Anfang jedes Schnittes für jeden Leiter 1 Zeile ergänzen mit Pos=-1 (Vorlage für die ergänzte Zeile: Pos=0)</span>
            
            <span class="c1"># Zeilen herausfinden</span>
            <span class="n">startRowIdx</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dfAGSN</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Pos&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c1">#print(row)</span>
                    <span class="n">startRowIdx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>                        
            <span class="n">dfStartRows</span><span class="o">=</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">startRowIdx</span><span class="p">,:]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">,</span><span class="s1">&#39;XL&#39;</span><span class="p">,</span><span class="s1">&#39;Pos&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="c1">#.drop_duplicates()</span>
            <span class="c1">#dfStartRows=dfStartRows[dfStartRows[&#39;Pos&#39;]==0]       </span>
            
            <span class="c1"># zu ergänzende Zeilen bearbeiten</span>
            
            <span class="c1"># - Pos = -1</span>
            <span class="c1"># - L = 0</span>
            <span class="c1"># - nextNODE ist der Startknoten in Schnittrichtung (also nicht nextNODE im Wortsinn)</span>
            <span class="c1"># - Ergebnissspalten bekommen die Werte des Startknotens in Schnittrichtung</span>
            <span class="c1"># - index: bleibt; d.h. unter den mehrfach belegten Indices sind ergänzte Zeilen (zu erkennen an Pos = -1)</span>
            
            <span class="n">dfRowsAdded</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">dfStartRows</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            
                    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Pos&#39;</span><span class="p">]</span><span class="o">=-</span><span class="mi">1</span>
                    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
                    
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">row</span><span class="p">[</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">]</span>                            
                        
                    <span class="k">for</span> <span class="n">col_n</span><span class="p">,</span><span class="n">col_i</span><span class="p">,</span><span class="n">col_k</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colsErg_n</span><span class="p">,</span><span class="n">colsErg_i</span><span class="p">,</span><span class="n">colsErg_k</span><span class="p">):</span>
                        <span class="c1">#print(col_n,col_i,col_k)</span>
                        
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>                                
                            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>                            
                                <span class="n">row</span><span class="p">[</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_i</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>                                
                                <span class="n">row</span><span class="p">[</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_k</span><span class="p">]</span> 
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>                            
                                <span class="n">row</span><span class="p">[</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_i</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>                                
                                <span class="n">row</span><span class="p">[</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">col_k</span><span class="p">]</span>                                                                             
                    
                    <span class="c1">#logger.debug(f&quot;{logStr} Pos -1: {row[&#39;NAME_i&#39;]} {row[&#39;NAME_k&#39;]} {row[&#39;direction&#39;]} PH_i={row[&#39;PH_i&#39;]} PH_k={row[&#39;PH_k&#39;]} PH_n={row[&#39;PH_n&#39;]} mlc_i={row[&#39;mlc_i&#39;]} mlc_k={row[&#39;mlc_k&#39;]} mlc_n={row[&#39;mlc_n&#39;]} &quot;) </span>
                    
                    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">row</span><span class="p">])</span>
                    <span class="n">dfRowsAdded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>                 
            
            <span class="c1"># Zeilen ergänzen</span>
            <span class="n">dfAGSN</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfAGSN</span><span class="p">]</span><span class="o">+</span><span class="n">dfRowsAdded</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">,</span><span class="s1">&#39;XL&#39;</span><span class="p">,</span><span class="s1">&#39;Pos&#39;</span><span class="p">])</span>
            
            <span class="c1"># Ergebnisspalten _i,_k löschen</span>
            <span class="n">dfAGSN</span><span class="o">=</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">colsErg_i</span><span class="o">+</span><span class="n">colsErg_k</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="c1"># Sachspalten _i,_k löschen</span>
            <span class="n">dfAGSN</span><span class="o">=</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">colsSach_i</span><span class="o">+</span><span class="n">colsSach_k</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                
                            
            <span class="n">dfAGSN</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dfAGSN</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>                
            <span class="n">cols</span><span class="o">=</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
            <span class="n">dfAGSN</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">cols</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;LSum&#39;</span><span class="p">,</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">,</span><span class="s1">&#39;XL&#39;</span><span class="p">])[</span><span class="s1">&#39;L&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">())</span>
            
            <span class="n">dfAGSN</span><span class="o">=</span><span class="n">dfAGSN</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">colsAGSNBase</span>
                                 <span class="o">+</span><span class="n">colsVBELBase</span>
                                 <span class="o">+</span><span class="n">colsSach_n</span> <span class="c1">#(u.a. ZKOR_n)</span>
                                 <span class="o">+</span><span class="p">[</span><span class="s1">&#39;LSum&#39;</span><span class="p">,</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span>
                                 <span class="o">+</span><span class="n">colsErg</span> <span class="c1"># die _i,_k gibt es hier bereits nicht mehr; nur die QM werden hier erfasst ...</span>
                                 <span class="o">+</span><span class="n">colsErg_n</span><span class="p">)</span>       
            
            <span class="c1"># mlc ergaenzen (denn H ist ggf. barBzg und nicht mlc)      </span>
            <span class="n">colsPH</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">colsRHO</span><span class="o">=</span><span class="p">[]</span>
            <span class="n">colsMlc</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dfAGSN</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;_n$&#39;</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>                                                
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">colTuple</span><span class="o">=</span><span class="n">fStripV3Colik2Tuple</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">colPost</span><span class="o">=</span><span class="s1">&#39;_n&#39;</span><span class="p">)</span>                            
                        <span class="k">if</span> <span class="n">colTuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;KNOT~*~*~*~PH_n&#39;</span><span class="p">:</span>
                                    <span class="n">colsPH</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                                    <span class="n">colsRHO</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;PH&#39;</span><span class="p">,</span><span class="s1">&#39;RHO&#39;</span><span class="p">))</span>
                                    <span class="n">colsMlc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;KNOT~*~*~*~PH&#39;</span><span class="p">,</span><span class="s1">&#39;mlc&#39;</span><span class="p">))</span> <span class="c1">#.replace(&#39;PH&#39;,&#39;mlc&#39;))                                                                    </span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="k">continue</span>
            
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">dfAGSN.columns.to_list(): zugeh. Ergspalten mlc angelegt: </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">colsMlc</span><span class="p">)))</span>  
                        
            <span class="c1"># zugeh. Ergebnisspalten mlc anlegen                </span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">colsMlc</span><span class="p">:</span>
                <span class="n">dfAGSN</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span>        
                <span class="c1">#logger.debug(f&quot;{logStr} colMlc: {col}&quot;) </span>
            
            <span class="c1"># Ergebnisspalten mlc bestücken</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">dfAGSN</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>                                                                                       
                    <span class="k">for</span> <span class="n">col_n</span><span class="p">,</span><span class="n">col_PH</span><span class="p">,</span><span class="n">col_RHO</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">colsMlc</span><span class="p">,</span><span class="n">colsPH</span><span class="p">,</span><span class="n">colsRHO</span><span class="p">):</span>                        
                        <span class="n">dfAGSN</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="n">col_n</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="n">col_PH</span><span class="p">]</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">5</span><span class="o">/</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">col_RHO</span><span class="p">]</span><span class="o">*</span><span class="mf">9.81</span><span class="p">)</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;ZKOR_n&#39;</span><span class="p">]</span>              
                    
            <span class="k">return</span> <span class="n">dfAGSN</span>     
        <span class="k">except</span> <span class="n">dxWithMxError</span><span class="p">:</span>
            <span class="k">raise</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span> 
            <span class="k">raise</span> <span class="n">dxWithMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                       
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">_Done.&quot;</span><span class="p">)</span> 

    <span class="k">def</span> <span class="nf">_V3_AGSNVEC</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">V3_AGSN</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        V3_AGSNVEC is a m object Attribute.</span>
<span class="sd">        </span>
<span class="sd">        :param V3_AGSN: V3_AGSN</span>
<span class="sd">        :type V3_AGSN: df</span>
<span class="sd">        </span>
<span class="sd">        :return: V3_AGSNVEC: V3_AGSN expanded to V3_AGSNVEC</span>
<span class="sd">        :rtype: df        </span>
<span class="sd">        </span>
<span class="sd">        .. note:: </span>
<span class="sd">            </span>
<span class="sd">            The returned V3_AGSNVEC (expand for PIPEs in (Section,Layer) one row to one row per point) has the following columns:</span>
<span class="sd">                V3_AGSN-columns:</span>
<span class="sd">                    - Pos: Pos=-1: eliminated if Start-Edge is a Pipe                     </span>
<span class="sd">                    - nextNODE: Pos=0: startNODE @IptIdxAsNo=0 if Start-Edge is a Pipe</span>
<span class="sd">                    - LSum: Pos=0: 0. @IptIdxAsNo=0 if Start-Edge is a Pipe </span>
<span class="sd">                    - ...</span>
<span class="sd">                    - cols mapped with VEC-Results:</span>
<span class="sd">                    - LSum</span>
<span class="sd">                    - ZKOR_n</span>
<span class="sd">                    - PH_n</span>
<span class="sd">                    - H_n</span>
<span class="sd">                    - mlc_n</span>
<span class="sd">                    - T_n</span>
<span class="sd">                    - QM                 </span>
<span class="sd">                V3_ROHRVEC-columns:</span>
<span class="sd">                    - pk_ROHRVEC: Pipe-pk</span>
<span class="sd">                    - tk_ROHRVEC: Pipe-tk                </span>
<span class="sd">                    - ...</span>
<span class="sd">                    - L_ROHRVEC</span>
<span class="sd">                    - ...</span>
<span class="sd">                    - NAME_i_ROHRVEC, NAME_k_ROHRVEC</span>
<span class="sd">                    - mx2NofPts</span>
<span class="sd">                    - dL (=L/(mx2NofPts-1))</span>
<span class="sd">                    - ...</span>
<span class="sd">                    - mx2Idx</span>
<span class="sd">                    - IptIdx: rows S or E are eliminated for all pipes except the 1st </span>
<span class="sd">                    - ...           </span>
<span class="sd">        &quot;&quot;&quot;</span>   
                
        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">Start.&quot;</span><span class="p">)</span> 
        
        <span class="k">try</span><span class="p">:</span> 
            
            <span class="k">if</span> <span class="n">V3_AGSN</span><span class="p">[</span><span class="o">~</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;-1&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
               <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2"> V3_AGSN empty.&quot;</span><span class="p">)</span> 
               <span class="k">return</span> <span class="n">V3_AGSN</span>
       
            <span class="n">V3_AGSN</span><span class="o">=</span><span class="n">V3_AGSN</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                        
            <span class="n">V3_AGSNPos</span><span class="o">=</span><span class="n">V3_AGSN</span><span class="p">[</span>
                            <span class="p">(</span>
                            <span class="p">(</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="o">|</span>
                            <span class="p">(</span> 
                            <span class="p">(</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">]))</span>
                            <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="p">)</span>     
                            <span class="o">|</span>                
                            <span class="o">~</span><span class="p">(</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;OBJTYPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;ROHR&#39;</span><span class="p">]))</span>
                            <span class="p">]</span>
            <span class="n">V3_AGSNNeg</span><span class="o">=</span><span class="n">V3_AGSN</span><span class="p">[</span>
                            <span class="p">(</span>
                            <span class="p">(</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
                            <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="o">|</span>
                            <span class="p">(</span> 
                            <span class="p">(</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">2</span><span class="p">]))</span>
                            <span class="o">&amp;</span>
                            <span class="p">(</span><span class="n">V3_AGSN</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
                            <span class="p">)</span>                     
                            <span class="p">]</span>            
                                    
            <span class="n">dfAGSNVecPos</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">V3_AGSNPos</span>
                <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHRVEC</span>
                <span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;OBJID&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;tk&#39;</span>
                <span class="p">,</span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_ROHRVEC&#39;</span><span class="p">)</span>
                <span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span> <span class="c1"># denn der Schnitt kann auch über Objekte ungl. Rohr fuehren ...</span>
            <span class="p">)</span>            
            <span class="n">dfAGSNVecNeg</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">V3_AGSNNeg</span>
                <span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHRVEC</span><span class="o">.</span><span class="n">iloc</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#!</span>
                <span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;OBJID&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;tk&#39;</span>
                <span class="p">,</span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;_ROHRVEC&#39;</span><span class="p">)</span>            
            <span class="p">)</span>    
            <span class="n">dfAGSNVecNeg</span><span class="p">[</span><span class="s1">&#39;IptIdxAsNo&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dfAGSNVecNeg</span><span class="p">[</span><span class="s1">&#39;IptIdxAsNoRev&#39;</span><span class="p">]</span>
            <span class="n">dfAGSNVecNeg</span><span class="p">[</span><span class="s1">&#39;SVEC&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dfAGSNVecNeg</span><span class="p">[</span><span class="s1">&#39;SVECRev&#39;</span><span class="p">]</span>
            
            <span class="n">dfAGSNVec</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">dfAGSNVecPos</span><span class="p">,</span><span class="n">dfAGSNVecNeg</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">,</span><span class="s1">&#39;XL&#39;</span><span class="p">,</span><span class="s1">&#39;Pos&#39;</span><span class="p">,</span><span class="s1">&#39;IptIdxAsNo&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>              
            <span class="n">dfAGSNVec</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;IptIdxAsNoRev&#39;</span><span class="p">,</span><span class="s1">&#39;SVECRev&#39;</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    
                        
            <span class="n">dfAGSNVec</span><span class="p">[</span><span class="s1">&#39;SVEC&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="p">[</span><span class="s1">&#39;SVEC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

            <span class="c1"># elimination of Pos=-1 rows if Start-Edge is a Pipe              </span>
            <span class="n">idxToDel</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Pos&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;OBJTYPE&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;ROHR&#39;</span><span class="p">:</span>
                    <span class="n">idxToDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
            <span class="n">dfAGSNVec</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">idxToDel</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>    
            
            <span class="c1"># nextNODE to startNODE and LSum=0 for IptIdxAsNo=0 if Start-Edge is a Pipe </span>
            <span class="n">dfAGSNVecMinPos</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">,</span><span class="s1">&#39;XL&#39;</span><span class="p">])[</span><span class="s1">&#39;Pos&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Pos&#39;</span><span class="p">]</span><span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;IptIdxAsNo&#39;</span><span class="p">]</span><span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">minPos</span><span class="o">=</span><span class="n">dfAGSNVecMinPos</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">])]</span> 
                <span class="k">if</span> <span class="n">minPos</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="c1"># Start-Edge is a Pipe </span>
                    <span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;LSum&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span> <span class="ow">in</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span> <span class="ow">in</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                            <span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="s1">&#39;nextNODE&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">]</span>                            
            
            <span class="c1"># eliminate S or E for all Pipes except the 1st</span>
            <span class="c1">#dfAGSNVecMaxPos=dfAGSNVec.groupby(by=[&#39;LFDNR&#39;,&#39;XL&#39;])[&#39;Pos&#39;].max()</span>
            <span class="n">indToDelete</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;OBJTYPE&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;ROHR&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="n">minPos</span><span class="o">=</span><span class="n">dfAGSNVecMinPos</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">])]</span> 
                <span class="c1">#maxPos=dfAGSNVecMaxPos.loc[(row[&#39;LFDNR&#39;],row[&#39;XL&#39;])] </span>
                
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Pos&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">minPos</span><span class="p">:</span> <span class="c1"># nicht fuer das ROHR an 1. Position</span>
                    <span class="k">continue</span>
                
                <span class="c1">#if row[&#39;Pos&#39;]==maxPos:</span>
                <span class="c1">#    continue                </span>
                
                <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>         
                    <span class="c1"># im VL wird S geloescht wenn pos. def. in Schnittrichtung; sonst E</span>
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;IptIdx&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;S&#39;</span><span class="p">:</span>
                            <span class="n">indToDelete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;IptIdx&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;E&#39;</span><span class="p">:</span>
                            <span class="n">indToDelete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>     
                <span class="k">else</span><span class="p">:</span>                            
                    <span class="c1"># im RL wird E geloescht wenn pos. def. in Schnittrichtung; sonst S</span>
                      <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                          <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;IptIdx&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;E&#39;</span><span class="p">:</span>
                              <span class="n">indToDelete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                      <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span><span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
                          <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;IptIdx&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;S&#39;</span><span class="p">:</span>
                              <span class="n">indToDelete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>                                
            <span class="c1">#        </span>
            <span class="n">dfAGSNVec</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">indToDelete</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>    
            
            <span class="c1"># in Zeilen mit IptIdx &lt;&gt; S,E LSum durch LSum(Pos-1)+SVEC ersetzen    </span>
            <span class="n">dfAGSNVecMaxLSum</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">,</span><span class="s1">&#39;XL&#39;</span><span class="p">,</span><span class="s1">&#39;Pos&#39;</span><span class="p">])[</span><span class="s1">&#39;LSum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>            
            <span class="k">def</span> <span class="nf">fLSum</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>   
                <span class="k">try</span><span class="p">:</span>                    
                    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;IptIdx&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">]:</span>
                        <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;LSum&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;IptIdx&#39;</span><span class="p">]):</span>
                        <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;LSum&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Pos&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;LSum&#39;</span><span class="p">]</span>                    
                    
                    <span class="n">LSumPrev</span><span class="o">=</span><span class="n">dfAGSNVecMaxLSum</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;LFDNR&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;XL&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Pos&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span>
                    
                    <span class="k">return</span> <span class="n">LSumPrev</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;SVEC&#39;</span><span class="p">]</span>
                                                           
                <span class="k">except</span><span class="p">:</span>
                    <span class="c1"># ROHR am Anfang mit Innenpunkten</span>
                    <span class="k">return</span> <span class="mf">0.</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;SVEC&#39;</span><span class="p">]</span>                        
            <span class="n">dfAGSNVec</span><span class="p">[</span><span class="s1">&#39;LSum&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">fLSum</span><span class="p">(</span><span class="n">row</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                            
            <span class="c1"># cols mapped with VEC-Results</span>
            <span class="n">t0rVec</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> </span><span class="si">%X</span><span class="s1">&#39;</span><span class="p">))</span><span class="c1">#.%f&#39;))</span>
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">colVECType</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;PH_n&#39;</span><span class="p">,</span><span class="s1">&#39;mlc_n&#39;</span><span class="p">,</span><span class="s1">&#39;H_n&#39;</span><span class="p">,</span><span class="s1">&#39;QM&#39;</span><span class="p">],[</span><span class="s1">&#39;manPVEC&#39;</span><span class="p">,</span><span class="s1">&#39;mlcPVEC&#39;</span><span class="p">,</span><span class="s1">&#39;barBzgPVEC&#39;</span><span class="p">,</span><span class="s1">&#39;QMVEC&#39;</span><span class="p">]):</span>       
                <span class="k">pass</span>
                <span class="n">colVEC</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span><span class="p">,</span><span class="n">colVECType</span><span class="p">,</span><span class="n">t0rVec</span><span class="p">,</span><span class="n">t0rVec</span><span class="p">)</span>   
                <span class="c1">#logger.debug(f&quot;{logStr}colVEC: {colVEC}&quot;)        </span>
                <span class="n">dfAGSNVec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">colVEC</span><span class="p">])</span> <span class="k">else</span> <span class="n">row</span><span class="p">[</span><span class="n">colVEC</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">colVECType</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;T_n&#39;</span><span class="p">],[</span><span class="s1">&#39;TVEC&#39;</span><span class="p">]):</span>       
                <span class="k">pass</span>
                <span class="n">colVEC</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;STAT&#39;</span><span class="p">,</span><span class="s1">&#39;ROHR~*~*~*~&#39;</span><span class="o">+</span><span class="n">colVECType</span><span class="p">,</span><span class="n">t0rVec</span><span class="p">,</span><span class="n">t0rVec</span><span class="p">)</span>   
                <span class="c1">#logger.debug(f&quot;{logStr}colVEC: {colVEC}&quot;)                </span>
                <span class="n">dfAGSNVec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">colVEC</span><span class="p">])</span> <span class="k">else</span> <span class="n">row</span><span class="p">[</span><span class="n">colVEC</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>      
                
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span><span class="n">colVEC</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;ZKOR_n&#39;</span><span class="p">],[</span><span class="s1">&#39;ZVEC&#39;</span><span class="p">]):</span>       
                <span class="k">pass</span>
                <span class="n">colVEC</span><span class="o">=</span><span class="n">colVEC</span> 
                <span class="c1">#logger.debug(f&quot;{logStr}colVEC: {colVEC}&quot;)                </span>
                <span class="n">dfAGSNVec</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">dfAGSNVec</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">colVEC</span><span class="p">])</span> <span class="k">else</span> <span class="n">row</span><span class="p">[</span><span class="n">colVEC</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                     
                                                                                                                                    
            <span class="k">return</span> <span class="n">dfAGSNVec</span>
        <span class="k">except</span> <span class="n">dxWithMxError</span><span class="p">:</span>
            <span class="k">raise</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span> 
            <span class="k">raise</span> <span class="n">dxWithMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                       
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">_Done.&quot;</span><span class="p">)</span> 

    <span class="c1"># def setLayerContentTo(self,layerName,df):          </span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     Updates content of layerName to df&#39;s-content.</span>
        
    <span class="c1">#     :param layerName: name of an existing layer</span>
    <span class="c1">#     :type layerName: str</span>
        
    <span class="c1">#     :return: None</span>
    
    <span class="c1">#     .. note:: </span>
    <span class="c1">#         df&#39;s cols used:            </span>
    <span class="c1">#             - TYPE </span>
    <span class="c1">#             - ID                 </span>
    <span class="c1">#     &quot;&quot;&quot;           </span>
                
    <span class="c1">#     logStr = &quot;{0:s}.{1:s}: &quot;.format(self.__class__.__name__, sys._getframe().f_code.co_name)</span>
    <span class="c1">#     logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&#39;Start.&#39;)) </span>
        
    <span class="c1">#     try: </span>
                  
    <span class="c1">#         xk=self.dfLAYR[self.dfLAYR[&#39;NAME&#39;].isin([layerName])][&#39;tk&#39;].iloc[0]</span>
            
    <span class="c1">#         dfUpd=df.copy(deep=True)</span>
            
    <span class="c1">#         dfUpd[&#39;table&#39;]=&#39;LAYR&#39;</span>
    <span class="c1">#         dfUpd[&#39;attrib&#39;]=&#39;OBJS&#39;</span>
    <span class="c1">#         dfUpd[&#39;attribValue&#39;]=dfUpd.apply(lambda row: &quot;{:s}~{:s}\t&quot;.format(row[&#39;TYPE&#39;],row[&#39;ID&#39;]).encode(&#39;utf-8&#39;),axis=1)</span>
    <span class="c1">#         dfUpd[&#39;xk&#39;]=&#39;tk&#39;</span>
    <span class="c1">#         dfUpd[&#39;xkValue&#39;]=xk    </span>
            
    <span class="c1">#         dfUpd2=dfUpd.groupby(by=[&#39;xkValue&#39;]).agg({&#39;xkValue&#39;: &#39;first&#39;</span>
    <span class="c1">#                                             ,&#39;table&#39;: &#39;first&#39;</span>
    <span class="c1">#                                             ,&#39;attrib&#39;: &#39;first&#39;</span>
    <span class="c1">#                                             ,&#39;xk&#39;: &#39;first&#39;</span>
    <span class="c1">#                                             , &#39;attribValue&#39;: &#39;sum&#39;}).reset_index(drop=True)</span>
    <span class="c1">#         dfUpd2[&#39;attribValue&#39;]=dfUpd2[&#39;attribValue&#39;].apply(lambda x: x.rstrip())</span>
              
    <span class="c1">#         self.dx.update(dfUpd2)               </span>
        
    <span class="c1">#     except dxWithMxError:</span>
    <span class="c1">#         raise            </span>
    <span class="c1">#     except Exception as e:</span>
    <span class="c1">#         logStrFinal=&quot;{:s}Exception: Line: {:d}: {!s:s}: {:s}&quot;.format(logStr,sys.exc_info()[-1].tb_lineno,type(e),str(e))</span>
    <span class="c1">#         logger.error(logStrFinal) </span>
    <span class="c1">#         raise dxWithMxError(logStrFinal)                       </span>
    <span class="c1">#     finally:</span>
    <span class="c1">#         logger.debug(&quot;{0:s}{1:s}&quot;.format(logStr,&#39;_Done.&#39;))      </span>
            
            
    <span class="k">def</span> <span class="nf">switchV3DfColsToMultiindex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switches V3-Df cols to Multiindex-Cols.               </span>
<span class="sd">        &quot;&quot;&quot;</span>        
                
        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Start.&#39;</span><span class="p">))</span> 
        
        <span class="k">try</span><span class="p">:</span> 
           
            <span class="bp">self</span><span class="o">.</span><span class="n">V3_KNOT</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
                <span class="p">[</span><span class="n">fGetMultiindexTupleFromV3Col</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">V3_KNOT</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
                <span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">])</span>    
            
            <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
                <span class="p">[</span><span class="n">fGetMultiindexTupleFromV3Col</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">V3_ROHR</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
                <span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">])</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">V3_FWVB</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
                <span class="p">[</span><span class="n">fGetMultiindexTupleFromV3Col</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">V3_FWVB</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
                <span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">])</span>     
            
            <span class="bp">self</span><span class="o">.</span><span class="n">V3_VBEL</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span>
                <span class="p">[</span><span class="n">fGetMultiindexTupleFromV3Col</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">V3_VBEL</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()]</span>
                <span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">])</span>                
                                
        <span class="k">except</span> <span class="n">dxWithMxError</span><span class="p">:</span>
            <span class="k">raise</span>            
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span> 
            <span class="k">raise</span> <span class="n">dxWithMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                       
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;_Done.&#39;</span><span class="p">))</span>                  
        
<span class="k">class</span> <span class="nc">readDxAndMxError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    
<span class="k">class</span> <span class="nc">readDxAndMxGoto</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="readDxAndMx"><a class="viewcode-back" href="../functions.html#dxAndMxHelperFcts.readDxAndMx">[docs]</a><span class="k">def</span> <span class="nf">readDxAndMx</span><span class="p">(</span><span class="n">dbFile</span>            
                <span class="p">,</span><span class="n">preventPklDump</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">,</span><span class="n">forceSir3sRead</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">,</span><span class="n">maxRecords</span><span class="o">=</span><span class="kc">None</span>
                <span class="p">,</span><span class="n">mxsVecsResults2MxDf</span><span class="o">=</span><span class="kc">None</span>
                <span class="p">,</span><span class="n">mxsVecsResults2MxDfVecAggs</span><span class="o">=</span><span class="kc">None</span>
                <span class="p">,</span><span class="n">crs</span><span class="o">=</span><span class="kc">None</span>
                <span class="p">,</span><span class="n">logPathOutputFct</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span>
                <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads SIR 3S model and SIR 3S results and returns a dxWithMx object.</span>
<span class="sd">    </span>
<span class="sd">    Use maxRecords=0  to read only the model.</span>
<span class="sd">    Use maxRecords=1  to read only STAT (the steady state result).</span>
<span class="sd">    Use maxRecords=-1 to (re-)calculate the model by SirCalc.</span>

<span class="sd">    :param dbFile: Path to SIR 3S&#39; database file (&#39;modell.db3&#39; or &#39;modell.mdb&#39;). The database is read into a Dx object. The corresponding results are read into an Mx object if available.</span>
<span class="sd">    :type dbFile: str</span>
<span class="sd">    :param preventPklDump: Determines whether to prevent dumping objects read to pickle. If True, existing pickles are deleted, SIR 3S&#39; sources are read and no pickles are written. If False 3 pickles are written or overwritten if older than SIR 3S&#39; sources.</span>
<span class="sd">    :type preventPklDump: bool, optional, default=False</span>
<span class="sd">    :param forceSir3sRead: Determines whether to force reading from SIR 3S&#39; sources even if newer pickles exists. By default pickles are read if newer than SIR 3S&#39; sources.</span>
<span class="sd">    :type forceSir3sRead: bool, optional, default=False</span>
<span class="sd">    :param maxRecords: Use maxRecords=0 to read only the model. Use maxRecords=1 to read only STAT (the steady state result). Maximum number of MX-Results to read. If None, all results are read. Use maxRecords=-1 to (re-)calculate the model by SirCalc (by the newest SirCalc available below ``C:\\3S``).</span>
<span class="sd">    :type maxRecords: int, optional, default=None</span>
<span class="sd">    :param mxsVecsResults2MxDf: List of regular expressions for SIR 3S&#39; Vector-Results to be included in mx.df. Note that integrating Vector-Results in mx.df can significantly increase memory usage. Example: ``[&#39;ROHR~\*~\*~\*~PHR&#39;, &#39;ROHR~\*~\*~\*~FS&#39;, &#39;ROHR~\*~\*~\*~DSI&#39;, &#39;ROHR~\*~\*~\*~DSK&#39;]``</span>
<span class="sd">    :type mxsVecsResults2MxDf: list, optional, default=None</span>
<span class="sd">    :param mxsVecsResults2MxDfVecAggs: List of timesteps for SIR 3S&#39; Vector-Results to be included in mx.dfVecAggs. Note that integrating all timesteps in mx.dfVecAggs will increase memory usage up to MXS-Size. Example: [3,42,666]</span>
<span class="sd">    :type mxsVecsResults2MxDfVecAggs: list, optional, default=None</span>
<span class="sd">    :param crs: (=coordinate reference system) Determines crs used in geopandas-Dfs (Possible value:&#39;EPSG:25832&#39;). If None, crs will be read from SIR 3S&#39; database file.</span>
<span class="sd">    :type crs: str, optional, default=None</span>
<span class="sd">    :param logPathOutputFct: func logPathOutputFct(fileName) is used for logoutput of filenames unless explicitly stated otherwise in the logoutput</span>
<span class="sd">    :type logPathOutputFct: func, optional, default=os.path.relpath</span>

<span class="sd">    :return: An object containing the SIR 3S model and SIR 3S results.</span>
<span class="sd">    :rtype: dxWithMx</span>

<span class="sd">    .. note:: Dx contains data for all models in the SIR 3S database. Mx contains only the results for one model. SYSTEMKONFIG / VIEW_MODELLE are used to determine which one.</span>
<span class="sd">        </span>
<span class="sd">        The returned dxWithMx object has the following attributes:</span>
<span class="sd">    </span>
<span class="sd">            - Model: Dx object:</span>
<span class="sd">                - dx.dataFrames[...]: pandas-Dfs 1:1 from SIR 3S&#39; tables in database file</span>
<span class="sd">                - dx.dataFrames[...]: several pandas-Dfs derived from the 1:1 Dfs </span>
<span class="sd">        </span>
<span class="sd">            - Results: Mx object:</span>
<span class="sd">                - mx.df: pandas-Df (&#39;time curve data&#39;) from from SIR 3S&#39; MXS file(s)</span>
<span class="sd">                - mx.dfVecAggs: pandas-Df (&#39;vector data&#39;) from SIR 3S&#39; MXS file(s)</span>
<span class="sd">            - Miscellaneous:   </span>
<span class="sd">                - wDirMx: Mx-directory of the model</span>
<span class="sd">                - SirCalcXmlFile: SirCalc&#39;s Xml-File of the model</span>
<span class="sd">                - SirCalcExeFile: SirCalc Executable used to (re-)calculate the model</span>
<span class="sd">    </span>
<span class="sd">            - pandas-Dfs with Model- AND Result-Data:</span>
<span class="sd">                - V3_ROHR: Pipes</span>
<span class="sd">                - V3_FWVB: Housestations District Heating</span>
<span class="sd">                - V3_KNOT: Nodes </span>
<span class="sd">                - V3_VBEL: Edges</span>
<span class="sd">                - V3_ROHRVEC: Pipes including interior points </span>
<span class="sd">                - V3_AGSN: Longitudinal Sections; AGSN is the German abbreviation for longitudinal sections / cuts (defined in the SIR 3S model)</span>
<span class="sd">                - V3_AGSNVEC: Longitudinal Sections including Pipe interior points </span>
<span class="sd">                    </span>
<span class="sd">            - geopandas-Dfs based upon the Dfs above:</span>
<span class="sd">                - gdf_ROHR: Pipes</span>
<span class="sd">                - gdf_FWVB: Housestations District Heating</span>
<span class="sd">                - gdf_KNOT: Nodes </span>
<span class="sd">                                                </span>
<span class="sd">            - NetworkX-Graphs:</span>
<span class="sd">                - G</span>
<span class="sd">                - GSig</span>

<span class="sd">        Selected functions of the returned dxWithMx object:                </span>
<span class="sd">                - switchV3DfColsToMultiindex(): switch cols in V3_ROHR, V3_FWVB, V3_KNOT, V3_VBEL to Multiindex</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="c1">#import importlib</span>
    <span class="kn">import</span> <span class="nn">glob</span>
    
    <span class="n">dx</span><span class="o">=</span><span class="kc">None</span>
    <span class="n">mx</span><span class="o">=</span><span class="kc">None</span>
    
    <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Start.&#39;</span><span class="p">))</span>     
    
    <span class="k">try</span><span class="p">:</span>
        
        <span class="n">dx</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">mx</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">m</span><span class="o">=</span><span class="kc">None</span>
        <span class="n">SirCalcXmlFile</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># SirCalc&#39;s xmlFile</span>
        <span class="n">SirCalcExeFile</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># SirCalc Executable</span>
            
        <span class="n">dbFileDxPklRead</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">dbFilename</span><span class="p">,</span><span class="n">ext</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>
        <span class="n">dbFileDxPkl</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">-dx.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbFilename</span><span class="p">)</span>   
        
        <span class="k">if</span> <span class="n">preventPklDump</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">):</span>
              <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxPkl:s}</span><span class="s2"> exists and is deleted ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                   <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                  <span class="p">,</span><span class="n">dbFileDxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">)</span>                        
                  <span class="p">)</span>
                  <span class="p">)</span>
              <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">)</span>           
                
        <span class="k">if</span> <span class="ow">not</span> <span class="n">forceSir3sRead</span><span class="p">:</span>            
            <span class="c1"># Pkl existiert</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">):</span>                
                <span class="c1"># ist eine Datei und lesbar</span>
                <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">)</span> <span class="ow">and</span> <span class="n">access</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">,</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="c1"># ist neuer als die Modelldatenbank</span>
                    <span class="n">tDb</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>
                    <span class="n">tPkl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">)</span>
                    
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2"> tDb: </span><span class="si">{:s}</span><span class="s2"> tPkl: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span>
                                                                      <span class="p">,</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">tDb</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                                                                      <span class="p">,</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">tPkl</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>                                                                      
                                                                      <span class="p">))</span>    
                    
                    <span class="k">if</span> <span class="n">tDb</span> <span class="o">&lt;</span> <span class="n">tPkl</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxPkl:s}</span><span class="s2"> newer than </span><span class="si">{dbFile:s}</span><span class="s2"> and therefore read ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                             <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                            <span class="p">,</span><span class="n">dbFileDxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">)</span>
                            <span class="p">,</span><span class="n">dbFile</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  
                                <span class="n">dx</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  
                            <span class="n">dbFileDxPklRead</span><span class="o">=</span><span class="kc">True</span>
                        <span class="k">except</span><span class="p">:</span>                            
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxPkl:s}</span><span class="s2"> read error! - reading SIR 3S raw data ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                 <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                                <span class="p">,</span><span class="n">dbFileDxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">)</span>                                
                                <span class="p">)</span>
                                <span class="p">)</span>

        <span class="c1">### Modell lesen</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dbFileDxPklRead</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">dx</span><span class="o">=</span><span class="n">Dx</span><span class="o">.</span><span class="n">Dx</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">Dx</span><span class="o">.</span><span class="n">DxError</span><span class="p">:</span>
                <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{logStr:s}</span><span class="s2">dbFile: </span><span class="si">{dbFile:s}</span><span class="s2">: DxError!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                    <span class="p">,</span><span class="n">dbFile</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>
                    <span class="p">)</span>     
                <span class="k">raise</span> <span class="n">readDxAndMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>  
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">preventPklDump</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxPkl:s}</span><span class="s2"> exists and is overwritten...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                        <span class="p">,</span><span class="n">dbFileDxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">)</span>                        
                        <span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxPkl:s}</span><span class="s2"> is written ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                        <span class="p">,</span><span class="n">dbFileDxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">)</span>                        
                        <span class="p">)</span>
                        <span class="p">)</span>                                                                
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dbFileDxPkl</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  
                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>           
                    
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
                                                               
        <span class="c1">### Ergebnisse nicht lesen?!         </span>
        <span class="k">if</span> <span class="n">maxRecords</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>        
            <span class="n">m</span> <span class="o">=</span> <span class="n">dxWithMx</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">crs</span><span class="p">)</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{logStr:s}</span><span class="s2">dbFile: </span><span class="si">{dbFile:s}</span><span class="s2">: maxRecords==0: do not read MX-Results.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                <span class="p">,</span><span class="n">dbFile</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFile</span><span class="p">))</span>     
            <span class="k">raise</span> <span class="n">readDxAndMxGoto</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>     
                    
        <span class="c1">### mx Datenquelle bestimmen</span>
                
        <span class="c1">#!</span>
        <span class="n">dbFile</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">dx</span><span class="o">.</span><span class="n">dbFile</span><span class="p">)</span>        
        
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">detecting MX-Source for dx.dbFile (abspath) </span><span class="si">{dbFile:s}</span><span class="s2"> ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span>
                <span class="p">,</span><span class="n">dbFile</span><span class="o">=</span><span class="n">dbFile</span><span class="p">))</span>        
                                        
        <span class="c1"># wDir der Db</span>
        <span class="n">sk</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;SYSTEMKONFIG&#39;</span><span class="p">]</span>
        <span class="n">wDirDb</span><span class="o">=</span><span class="n">sk</span><span class="p">[</span><span class="n">sk</span><span class="p">[</span><span class="s1">&#39;ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.</span><span class="p">])][</span><span class="s1">&#39;WERT&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">wDir from dbFile: </span><span class="si">{wDirDb:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span><span class="p">,</span><span class="n">wDirDb</span><span class="o">=</span><span class="n">wDirDb</span><span class="p">))</span>
        <span class="c1">#!</span>
        <span class="n">wDir</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dbFile</span><span class="p">),</span><span class="n">wDirDb</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">abspath of wDir from dbFile: </span><span class="si">{wDir:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span><span class="p">,</span><span class="n">wDir</span><span class="o">=</span><span class="n">wDir</span><span class="p">))</span>

        <span class="c1"># SYSTEMKONFIG ID 3:</span>
        <span class="c1"># Modell-Pk des in QGIS anzuzeigenden Modells (wird von den QGIS-Views ausgewertet)</span>
        <span class="c1"># diese xk wird hier verwendet um das Modell in der DB zu identifizieren dessen Ergebnisse geliefert werden sollen</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vm</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;VIEW_MODELLE&#39;</span><span class="p">]</span>
            <span class="c1">#modelXk=sk[sk[&#39;ID&#39;].isin([3,3.])][&#39;WERT&#39;].iloc[0]</span>
            <span class="n">vms</span><span class="o">=</span><span class="n">vm</span><span class="p">[</span><span class="n">vm</span><span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="n">dx</span><span class="o">.</span><span class="n">QGISmodelXk</span><span class="p">])]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>   
        <span class="k">except</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}</span><span class="s2"> QGISmodelXk not defined. Now the MX of 1st Model in VIEW_MODELLE is used ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span><span class="p">))</span>
            <span class="n">vms</span><span class="o">=</span><span class="n">vm</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  
        
        <span class="c1">#!                        </span>
        <span class="n">wDirMx</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wDir</span><span class="p">,</span><span class="n">vms</span><span class="o">.</span><span class="n">Basis</span><span class="p">),</span><span class="n">vms</span><span class="o">.</span><span class="n">Variante</span><span class="p">),</span><span class="n">vms</span><span class="o">.</span><span class="n">BZ</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">wDirMx from abspath of wDir from dbFile: </span><span class="si">{wDirMx:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span><span class="p">,</span><span class="n">wDirMx</span><span class="o">=</span><span class="n">wDirMx</span><span class="p">))</span>
                        
        <span class="n">wDirMxMx1Content</span><span class="o">=</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wDirMx</span><span class="p">,</span><span class="s1">&#39;*.MX1&#39;</span><span class="p">))</span>
        <span class="n">wDirMxMx1Content</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">wDirMxMx1Content</span><span class="p">)</span> 

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wDirMxMx1Content</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">More than one (</span><span class="si">{anz:d}</span><span class="s2">) MX1-Files in wDir. The 1st MX1-File is used.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span><span class="p">,</span><span class="n">anz</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">wDirMxMx1Content</span><span class="p">)))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wDirMxMx1Content</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">:</span>        
            <span class="n">mx1File</span><span class="o">=</span> <span class="n">wDirMxMx1Content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">mx1File: </span><span class="si">{mx1File:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span>
                <span class="p">,</span><span class="n">mx1File</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)))</span>
                    
            <span class="n">dbFileMxPklRead</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">dbFileMxPkl</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">-mx-</span><span class="si">{:s}</span><span class="s2">.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbFilename</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\W+&#39;</span><span class="p">,</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)))</span>                
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">corresponding dbFileMxPkl-File: </span><span class="si">{dbFileMxPkl:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span>
                <span class="p">,</span><span class="n">dbFileMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">)))</span>
            
            <span class="k">if</span> <span class="n">preventPklDump</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">):</span>
                      <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileMxPkl:s}</span><span class="s2"> exists and is deleted...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                           <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                          <span class="p">,</span><span class="n">dbFileMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">)</span>                        
                          <span class="p">)</span>
                          <span class="p">)</span>
                      <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">)</span>        
                           
            <span class="n">tDb</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>  
            
            <span class="c1"># SirCalcXml</span>
            <span class="n">wDirMxXmlContent</span><span class="o">=</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wDirMx</span><span class="p">,</span><span class="s1">&#39;*.XML&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wDirMxXmlContent</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">wDirMxXmlContent</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">wDirMxXmlContent</span><span class="p">)</span> 
                <span class="n">SirCalcXmlFile</span><span class="o">=</span> <span class="n">wDirMxXmlContent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">tXml</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">SirCalcXmlFile</span><span class="p">)</span>       
            <span class="k">else</span><span class="p">:</span>                    
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}</span><span class="s2">SirCalc&#39;s xmlFile not existing.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span><span class="p">))</span>  
                            
            <span class="c1"># mx1</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">mx1File</span><span class="p">):</span>  
                <span class="n">tMx</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tDb</span><span class="o">&gt;</span><span class="n">tMx</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}</span><span class="se">\n</span><span class="s2">+</span><span class="si">{dbFile:s}</span><span class="s2"> is newer than</span><span class="se">\n</span><span class="s2">+</span><span class="si">{mx1File:s}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">+SIR 3S&#39; dbFile is newer than SIR 3S&#39; mx1File</span><span class="se">\n</span><span class="s2">+in this case the results are maybe dated or (worse) incompatible to the model&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>                    
                        <span class="p">,</span><span class="n">mx1File</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)</span>
                        <span class="p">,</span><span class="n">dbFile</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="p">)</span>                     
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wDirMxXmlContent</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">wDirMxXmlContent</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">wDirMxXmlContent</span><span class="p">)</span> 
                        <span class="c1">#xmlFile= wDirMxXmlContent[0]                        </span>
                        <span class="k">if</span> <span class="n">tMx</span><span class="o">&gt;=</span><span class="n">tXml</span><span class="p">:</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>                            
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}</span><span class="se">\n</span><span class="s2">+</span><span class="si">{xmlFile:s}</span><span class="s2"> is newer than</span><span class="se">\n</span><span class="s2">+</span><span class="si">{mx1File:s}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">+SirCalc&#39;s xmlFile is newer than SIR 3S&#39; mx1File</span><span class="se">\n</span><span class="s2">+in this case the results are maybe dated or (worse) incompatible to the model&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                 <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>                    
                                <span class="p">,</span><span class="n">xmlFile</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">SirCalcXmlFile</span><span class="p">)</span>
                                <span class="p">,</span><span class="n">mx1File</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)</span>
                                <span class="p">)</span>
                                <span class="p">)</span>
            <span class="c1">### Ergebnisse neu berechnen  </span>
            <span class="k">if</span> <span class="n">maxRecords</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">maxRecords</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">wDirMxMx1Content</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">wDirMxXmlContent</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    
                    <span class="n">SirCalcFiles</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">installDir</span>  <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">3S&quot;</span> 
                    <span class="n">installName</span> <span class="o">=</span> <span class="s2">&quot;SirCalc.exe&quot;</span>
                    <span class="n">SirCalcOptions</span><span class="o">=</span><span class="s2">&quot;/rstnSpezial /InteraktRgMax100 /InteraktThMax50&quot;</span>
                    
                    <span class="k">for</span> <span class="n">file</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">installDir</span><span class="p">):</span>
                        <span class="n">SirCalcFiles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">file</span><span class="p">,</span><span class="n">installName</span><span class="p">)))</span> 
                    
                    <span class="n">SirCalcFiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span>  <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">SirCalcFiles</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">file</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">file</span><span class="p">))</span> <span class="p">)]</span>
                    
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SirCalcFiles</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>                    
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">SirCalc not found. No (re-)calculation.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span>                    
                        <span class="p">))</span>                    
                    
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">SirCalcExeFile</span><span class="o">=</span><span class="n">SirCalcFiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">running </span><span class="si">{SirCalc:s}</span><span class="s2"> ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span>
                        <span class="p">,</span><span class="n">SirCalc</span><span class="o">=</span><span class="n">SirCalcExeFile</span>
                        <span class="p">))</span>
                                                    
                        <span class="k">with</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">SirCalcExeFile</span><span class="p">,</span><span class="n">SirCalcXmlFile</span><span class="p">,</span><span class="n">SirCalcOptions</span><span class="p">])</span> <span class="k">as</span> <span class="n">process</span><span class="p">:</span>
                            <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
             <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">No MX1-File(s) in wDir. Continue without MX ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
             <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span><span class="p">))</span>
                
             <span class="n">m</span> <span class="o">=</span> <span class="n">dxWithMx</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">crs</span><span class="p">)</span>
                          
             <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;... m without MX finished.&#39;</span><span class="p">)</span>
             <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>   
             <span class="k">raise</span> <span class="n">readDxAndMxGoto</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                  
             
        <span class="k">if</span> <span class="ow">not</span> <span class="n">forceSir3sRead</span><span class="p">:</span>            
            <span class="c1"># Pkl existiert</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">):</span>                
                <span class="c1"># ist eine Datei und lesbar</span>
                <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">)</span> <span class="ow">and</span> <span class="n">access</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">,</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="c1"># ist neuer als mx1File</span>
                    <span class="n">tMx</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)</span>
                    <span class="n">tPkl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">)</span>                    
                                        
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2"> tMx: </span><span class="si">{:s}</span><span class="s2"> tPkl: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span>
                                                  <span class="p">,</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">tMx</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                                                  <span class="p">,</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="n">tPkl</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>                                                                      
                                                  <span class="p">))</span>                        
                                        
                    <span class="k">if</span> <span class="n">tMx</span> <span class="o">&lt;</span> <span class="n">tPkl</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileMxPkl:s}</span><span class="s2"> newer than </span><span class="si">{mx1File:s}</span><span class="s2"> and therefore read ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                             <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                            <span class="p">,</span><span class="n">dbFileMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">)</span>
                            <span class="p">,</span><span class="n">mx1File</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  
                                <span class="n">mx</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  
                            <span class="n">dbFileMxPklRead</span><span class="o">=</span><span class="kc">True</span>       
                        <span class="k">except</span><span class="p">:</span>                            
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileMxPkl:s}</span><span class="s2"> read error! - reading SIR 3S raw data ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                 <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                                <span class="p">,</span><span class="n">dbFileMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">)</span>                                
                                <span class="p">)</span>
                                <span class="p">)</span>                        
                        
                        
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dbFileMxPklRead</span><span class="p">:</span>
        
            <span class="c1">### Modellergebnisse lesen</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mx</span><span class="o">=</span><span class="n">Mx</span><span class="o">.</span><span class="n">Mx</span><span class="p">(</span><span class="n">mx1File</span><span class="p">,</span><span class="n">maxRecords</span><span class="o">=</span><span class="n">maxRecords</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;MX read ok so far.&#39;</span><span class="p">))</span>   
                                             
            <span class="k">except</span> <span class="n">Mx</span><span class="o">.</span><span class="n">MxError</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;MX read failed. Continue without MX ...&#39;</span><span class="p">))</span>   
            
                <span class="n">m</span> <span class="o">=</span> <span class="n">dxWithMx</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="n">crs</span><span class="p">)</span>
                
                <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;... m without MX finished.&#39;</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>   
                <span class="k">raise</span> <span class="n">readDxAndMxGoto</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>     
                
                
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>                    
                <span class="k">raise</span>
                
                
            <span class="c1"># </span>
            <span class="n">processMxVectorResults</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">mxsVecsResults2MxDf</span><span class="p">,</span><span class="n">mxsVecsResults2MxDfVecAggs</span><span class="p">)</span>
            
            <span class="c1"># ### Vector-Results 2 MxDf</span>
            <span class="c1"># if mxsVecsResults2MxDf != None:</span>
            <span class="c1">#     try:                </span>
            <span class="c1">#         df=mx.readMxsVecsResultsForObjectType(Sir3sVecIDReExp=mxsVecsResults2MxDf,flatIndex=False)                    </span>
            <span class="c1">#         logger.debug(&quot;{logStr:s} df from readMxsVecsResultsForObjectType: {dfStr:s}&quot;.format(</span>
            <span class="c1">#             logStr=logStr,dfStr=df.head(5).to_string()))</span>
                    
            <span class="c1">#         # Kanalweise bearbeiten</span>
            <span class="c1">#         vecChannels=sorted(list(set(df.index.get_level_values(1))))</span>
                    
            <span class="c1">#         V3_VBEL=dx.dataFrames[&#39;V3_VBEL&#39;]</span>
                    
                    
            <span class="c1">#         mxVecChannelDfs={}</span>
            <span class="c1">#         for vecChannel in vecChannels:</span>
                        
            <span class="c1">#             #print(vecChannel)</span>
                        
            <span class="c1">#             dfVecChannel=df.loc[(slice(None),vecChannel,slice(None),slice(None)),:]</span>
            <span class="c1">#             dfVecChannel.index=dfVecChannel.index.get_level_values(2).rename(&#39;TIME&#39;)</span>
            <span class="c1">#             dfVecChannel=dfVecChannel.dropna(axis=1,how=&#39;all&#39;)</span>
                        
            <span class="c1">#             mObj=re.search(Mx.regExpSir3sVecIDObjAtr,vecChannel)                    </span>
            <span class="c1">#             OBJTYPE,ATTRTYPE=mObj.groups()</span>
                               
            <span class="c1">#             # Zeiten aendern wg. spaeterem concat mit mx.df</span>
            <span class="c1">#             dfVecChannel.index=[pd.Timestamp(t,tz=&#39;UTC&#39;) for t in dfVecChannel.index]</span>
                        
            <span class="c1">#             if OBJTYPE == &#39;KNOT&#39;:</span>
            <span class="c1">#                 dfOBJT=dx.dataFrames[&#39;V_BVZ_KNOT&#39;][[&#39;tk&#39;,&#39;NAME&#39;]]</span>
            <span class="c1">#                 dfOBJT.index=dfOBJT[&#39;tk&#39;]</span>
            <span class="c1">#                 colRenDctToNamesMxDf={col:&quot;{:s}~{!s:s}~*~{:s}~{:s}&quot;.format(OBJTYPE,dfOBJT.loc[col,&#39;NAME&#39;],col,ATTRTYPE) for col in dfVecChannel.columns.to_list()}</span>
            <span class="c1">#             else:    </span>
            <span class="c1">#                 dfOBJT=V3_VBEL[[&#39;pk&#39;,&#39;NAME_i&#39;,&#39;NAME_k&#39;]].loc[(OBJTYPE,slice(None)),:]</span>
            <span class="c1">#                 dfOBJT.index=dfOBJT.index.get_level_values(1) # die OBJID; xk</span>
            <span class="c1">#                 colRenDctToNamesMxDf={col:&quot;{:s}~{!s:s}~{!s:s}~{:s}~{:s}&quot;.format(OBJTYPE,dfOBJT.loc[col,&#39;NAME_i&#39;],dfOBJT.loc[col,&#39;NAME_k&#39;],col,ATTRTYPE) for col in dfVecChannel.columns.to_list()}</span>
                                  
            <span class="c1">#             dfVecChannel=dfVecChannel.rename(columns=colRenDctToNamesMxDf)</span>
                        
            <span class="c1">#             mxVecChannelDfs[vecChannel]=dfVecChannel         </span>
                                            
            <span class="c1">#         l=mx.df.columns.to_list()</span>
            <span class="c1">#         logger.debug(&quot;{:s} Anzahl der Spalten vor Ergaenzung der Vektorspalten: {:d}&quot;.format(logStr,len(l)))</span>
                        
            <span class="c1">#         mx.df=pd.concat([mx.df]</span>
            <span class="c1">#         +list(mxVecChannelDfs.values())               </span>
            <span class="c1">#         ,axis=1)</span>
                    
            <span class="c1">#         l=mx.df.columns.to_list()</span>
            <span class="c1">#         logger.debug(&quot;{:s} Anzahl der Spalten nach Ergaenzung der Vektorspalten: {:d}&quot;.format(logStr,len(l)))                </span>
                    
            <span class="c1">#         # Test auf mehrfach vorkommende Spaltennamen                </span>
            <span class="c1">#         l=mx.df.loc[:,mx.df.columns.duplicated()].columns.to_list()</span>
            <span class="c1">#         if len(l)&gt;0:</span>
            <span class="c1">#             logger.debug(&quot;{:s} Anzahl der Spaltennamen die mehrfach vorkommen: {:d}; eliminieren der mehrfach vorkommenden ... &quot;.format(logStr,len(l)))</span>
            <span class="c1">#             mx.df = mx.df.loc[:,~mx.df.columns.duplicated()]</span>
                           
            <span class="c1">#         l=mx.df.columns.to_list()    </span>
            <span class="c1">#         logger.debug(&quot;{:s} Anzahl der Spalten nach Ergaenzung der Vektorspalten und nach eliminieren der mehrfach vorkommenden: {:d}&quot;.format(logStr,len(l)))</span>
                        
                        
            <span class="c1">#     except Mx.MxError:</span>
            <span class="c1">#         logStrFinal=&quot;{logStr:s}mxsVecsResults2MxDf failed&quot;.format(logStr=logStr)     </span>
            <span class="c1">#         raise readDxAndMxError(logStrFinal)             </span>
        
            <span class="c1"># ### Vector-Results 2 MxDfVecAggs</span>
            <span class="c1"># if mxsVecsResults2MxDfVecAggs != None:</span>
            <span class="c1">#     try:         </span>
            <span class="c1">#         for idxTime in mxsVecsResults2MxDfVecAggs:</span>
            <span class="c1">#             try:</span>
            <span class="c1">#                 aTime=mx.df.index[idxTime]</span>
            <span class="c1">#             except:</span>
            <span class="c1">#                 logger.info(f&quot;{logStr}: Requested Timestep {idxTime} not in MX-Results.&quot;)  </span>
            <span class="c1">#                 continue</span>
                        
            <span class="c1">#             df,tL,tR=mx.getVecAggs(time1st=aTime,aTIME=True)</span>
                                            
            <span class="c1">#     except Mx.MxError:</span>
            <span class="c1">#         logStrFinal=&quot;{logStr:s}mxsVecsResults2MxDf failed&quot;.format(logStr=logStr)     </span>
            <span class="c1">#         raise readDxAndMxError(logStrFinal)             </span>

        
            <span class="k">if</span> <span class="ow">not</span> <span class="n">preventPklDump</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileMxPkl:s}</span><span class="s2"> exists and is overwritten...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                        <span class="p">,</span><span class="n">dbFileMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">)</span>                        
                        <span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileMxPkl:s}</span><span class="s2"> is written ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                        <span class="p">,</span><span class="n">dbFileMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">)</span>                        
                        <span class="p">)</span>
                        <span class="p">)</span>                                                                
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dbFileMxPkl</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  
                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>     
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
                                             
        <span class="n">dbFileDxMxPklRead</span><span class="o">=</span><span class="kc">False</span>
        <span class="n">dbFileDxMxPkl</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">-m.pkl&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dbFilename</span><span class="p">)</span>        
        
        <span class="k">if</span> <span class="n">preventPklDump</span><span class="p">:</span>        
            <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">):</span>
                      <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxMxPkl:s}</span><span class="s2"> exists and is deleted...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                           <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                          <span class="p">,</span><span class="n">dbFileDxMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">)</span>                        
                          <span class="p">)</span>
                          <span class="p">)</span>
                      <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">)</span>        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStrPrefix:s}</span><span class="s2">corresp. dbFileDxMxPkl-File: </span><span class="si">{dbFileDxMxPkl:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">logStrPrefix</span><span class="o">=</span><span class="n">logStr</span>
                <span class="p">,</span><span class="n">dbFileDxMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">)</span>
                <span class="p">))</span>
                
        <span class="k">if</span> <span class="ow">not</span> <span class="n">forceSir3sRead</span><span class="p">:</span>            
            <span class="c1"># Pkl existiert</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">):</span>                
                <span class="c1"># ist eine Datei und lesbar</span>
                <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">)</span> <span class="ow">and</span> <span class="n">access</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">,</span><span class="n">R_OK</span><span class="p">):</span>
                    <span class="c1"># ist neuer als mx1File und dbFile</span>
                    
                    <span class="n">tMx1</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)</span>
                    <span class="n">tDb</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>
                    <span class="n">tPkl</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getmtime</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">)</span>
                                                            
                    <span class="k">if</span> <span class="p">(</span><span class="n">tMx1</span> <span class="o">&lt;</span> <span class="n">tPkl</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">tDb</span> <span class="o">&lt;</span> <span class="n">tPkl</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxMxPkl:s}</span><span class="s2"> newer than </span><span class="si">{mx1File:s}</span><span class="s2"> and </span><span class="si">{dbFile:s}</span><span class="s2"> and therefore read ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                             <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                            <span class="p">,</span><span class="n">dbFileDxMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">)</span>
                            <span class="p">,</span><span class="n">mx1File</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)</span>
                            <span class="p">,</span><span class="n">dbFile</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFile</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="p">)</span>                        
                        <span class="k">try</span><span class="p">:</span>
                           <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  
                               <span class="n">m</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  
                           <span class="n">dbFileDxMxPklRead</span><span class="o">=</span><span class="kc">True</span>    
                        <span class="k">except</span><span class="p">:</span>                            
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxMxPkl:s}</span><span class="s2"> read error! - processing dx and mx ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                                 <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                                <span class="p">,</span><span class="n">dbFileDxMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">)</span>                                
                                <span class="p">)</span>
                                <span class="p">)</span>                            
                                                    
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dbFileDxMxPklRead</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">dxWithMx</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">mx</span><span class="p">,</span><span class="n">crs</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">wDirMx</span><span class="o">=</span><span class="n">wDirMx</span>
            <span class="k">if</span> <span class="n">SirCalcXmlFile</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>                
                <span class="n">m</span><span class="o">.</span><span class="n">SirCalcXmlFile</span><span class="o">=</span><span class="n">SirCalcXmlFile</span>
            <span class="k">if</span> <span class="n">SirCalcExeFile</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">m</span><span class="o">.</span><span class="n">SirCalcExeFile</span><span class="o">=</span><span class="n">SirCalcExeFile</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">preventPklDump</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">isfile</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxMxPkl:s}</span><span class="s2"> exists and is overwritten...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                        <span class="p">,</span><span class="n">dbFileDxMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">)</span>                        
                        <span class="p">)</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}{dbFileDxMxPkl:s}</span><span class="s2"> is written ...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span>
                        <span class="p">,</span><span class="n">dbFileDxMxPkl</span><span class="o">=</span><span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">)</span>                        
                        <span class="p">)</span>
                        <span class="p">)</span>                                                                
                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dbFileDxMxPkl</span><span class="p">,</span><span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>  
                    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>       
            
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
                <span class="c1"># if isfile(dbFileDxMxPkl):</span>
                <span class="c1">#           logger.info(&quot;{logStr:s}{dbFileDxMxPkl:s} exists and is deleted...&quot;.format(</span>
                <span class="c1">#                logStr=logStr</span>
                <span class="c1">#               ,dbFileDxMxPkl=dbFileDxMxPkl                        </span>
                <span class="c1">#               )</span>
                <span class="c1">#               )</span>
                <span class="c1">#           os.remove(dbFileDxMxPkl)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
                               
    <span class="k">except</span> <span class="n">readDxAndMxGoto</span><span class="p">:</span>        
        <span class="k">pass</span> 

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>      
        
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;_Done.&#39;</span><span class="p">))</span>  
        <span class="k">return</span> <span class="n">m</span></div>

<span class="k">def</span> <span class="nf">processMxVectorResults</span><span class="p">(</span><span class="n">mx</span><span class="p">,</span><span class="n">dx</span>
                <span class="p">,</span><span class="n">mxsVecsResults2MxDf</span><span class="o">=</span><span class="kc">None</span>
                <span class="p">,</span><span class="n">mxsVecsResults2MxDfVecAggs</span><span class="o">=</span><span class="kc">None</span>              
                <span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Processes Mx-Vector-Results.</span>
<span class="sd">    </span>
<span class="sd">    :param mx: Mx object</span>
<span class="sd">    :type mx: Mx.Mx</span>
<span class="sd">    :param dx: Dx object</span>
<span class="sd">    :type dx: Dx.Dx    </span>
<span class="sd">    :param mxsVecsResults2MxDf: List of regular expressions for SIR 3S&#39; Vector-Results to be included in mx.df. Note that integrating Vector-Results in mx.df can significantly increase memory usage. Example: ``[&#39;ROHR~\*~\*~\*~PHR&#39;, &#39;ROHR~\*~\*~\*~FS&#39;, &#39;ROHR~\*~\*~\*~DSI&#39;, &#39;ROHR~\*~\*~\*~DSK&#39;]``</span>
<span class="sd">    :type mxsVecsResults2MxDf: list, optional, default=None</span>
<span class="sd">    :param mxsVecsResults2MxDfVecAggs: List of timesteps for SIR 3S&#39; Vector-Results to be included in mx.dfVecAggs. Note that integrating all timesteps in mx.dfVecAggs will increase memory usage up to MXS-Size. Example: [3,42,666]</span>
<span class="sd">    :type mxsVecsResults2MxDfVecAggs: list, optional, default=None                    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Start.&#39;</span><span class="p">))</span>     
    
    <span class="k">try</span><span class="p">:</span>
                        
            <span class="c1">### Vector-Results 2 MxDf</span>
            <span class="k">if</span> <span class="n">mxsVecsResults2MxDf</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>                
                    <span class="n">df</span><span class="o">=</span><span class="n">mx</span><span class="o">.</span><span class="n">readMxsVecsResultsForObjectType</span><span class="p">(</span><span class="n">Sir3sVecIDReExp</span><span class="o">=</span><span class="n">mxsVecsResults2MxDf</span><span class="p">,</span><span class="n">flatIndex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>                    
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{logStr:s}</span><span class="s2"> df from readMxsVecsResultsForObjectType: </span><span class="si">{dfStr:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span><span class="p">,</span><span class="n">dfStr</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">to_string</span><span class="p">()))</span>
                    
                    <span class="c1"># Kanalweise bearbeiten</span>
                    <span class="n">vecChannels</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">))))</span>
                    
                    <span class="n">V3_VBEL</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V3_VBEL&#39;</span><span class="p">]</span>
                    
                    
                    <span class="n">mxVecChannelDfs</span><span class="o">=</span><span class="p">{}</span>
                    <span class="k">for</span> <span class="n">vecChannel</span> <span class="ow">in</span> <span class="n">vecChannels</span><span class="p">:</span>
                        
                        <span class="c1">#print(vecChannel)</span>
                        
                        <span class="n">dfVecChannel</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="n">vecChannel</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">),</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)),:]</span>
                        <span class="n">dfVecChannel</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">dfVecChannel</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;TIME&#39;</span><span class="p">)</span>
                        <span class="n">dfVecChannel</span><span class="o">=</span><span class="n">dfVecChannel</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
                        
                        <span class="n">mObj</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">Mx</span><span class="o">.</span><span class="n">regExpSir3sVecIDObjAtr</span><span class="p">,</span><span class="n">vecChannel</span><span class="p">)</span>                    
                        <span class="n">OBJTYPE</span><span class="p">,</span><span class="n">ATTRTYPE</span><span class="o">=</span><span class="n">mObj</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                               
                        <span class="c1"># Zeiten aendern wg. spaeterem concat mit mx.df</span>
                        <span class="n">dfVecChannel</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dfVecChannel</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
                        
                        <span class="k">if</span> <span class="n">OBJTYPE</span> <span class="o">==</span> <span class="s1">&#39;KNOT&#39;</span><span class="p">:</span>
                            <span class="n">dfOBJT</span><span class="o">=</span><span class="n">dx</span><span class="o">.</span><span class="n">dataFrames</span><span class="p">[</span><span class="s1">&#39;V_BVZ_KNOT&#39;</span><span class="p">][[</span><span class="s1">&#39;tk&#39;</span><span class="p">,</span><span class="s1">&#39;NAME&#39;</span><span class="p">]]</span>
                            <span class="n">dfOBJT</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">dfOBJT</span><span class="p">[</span><span class="s1">&#39;tk&#39;</span><span class="p">]</span>
                            <span class="n">colRenDctToNamesMxDf</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">~</span><span class="si">{!s:s}</span><span class="s2">~*~</span><span class="si">{:s}</span><span class="s2">~</span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OBJTYPE</span><span class="p">,</span><span class="n">dfOBJT</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span><span class="s1">&#39;NAME&#39;</span><span class="p">],</span><span class="n">col</span><span class="p">,</span><span class="n">ATTRTYPE</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dfVecChannel</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()}</span>
                        <span class="k">else</span><span class="p">:</span>    
                            <span class="n">dfOBJT</span><span class="o">=</span><span class="n">V3_VBEL</span><span class="p">[[</span><span class="s1">&#39;pk&#39;</span><span class="p">,</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">,</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">OBJTYPE</span><span class="p">,</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)),:]</span>
                            <span class="n">dfOBJT</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">dfOBJT</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># die OBJID; xk</span>
                            <span class="n">colRenDctToNamesMxDf</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">~</span><span class="si">{!s:s}</span><span class="s2">~</span><span class="si">{!s:s}</span><span class="s2">~</span><span class="si">{:s}</span><span class="s2">~</span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">OBJTYPE</span><span class="p">,</span><span class="n">dfOBJT</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span><span class="s1">&#39;NAME_i&#39;</span><span class="p">],</span><span class="n">dfOBJT</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">col</span><span class="p">,</span><span class="s1">&#39;NAME_k&#39;</span><span class="p">],</span><span class="n">col</span><span class="p">,</span><span class="n">ATTRTYPE</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">dfVecChannel</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()}</span>
                                  
                        <span class="n">dfVecChannel</span><span class="o">=</span><span class="n">dfVecChannel</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">colRenDctToNamesMxDf</span><span class="p">)</span>
                        
                        <span class="n">mxVecChannelDfs</span><span class="p">[</span><span class="n">vecChannel</span><span class="p">]</span><span class="o">=</span><span class="n">dfVecChannel</span>         
                                            
                    <span class="n">l</span><span class="o">=</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2"> Anzahl der Spalten vor Ergaenzung der Vektorspalten: </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)))</span>
                        
                    <span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="p">]</span>
                    <span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">mxVecChannelDfs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>               
                    <span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    
                    <span class="n">l</span><span class="o">=</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2"> Anzahl der Spalten nach Ergaenzung der Vektorspalten: </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)))</span>                
                    
                    <span class="c1"># Test auf mehrfach vorkommende Spaltennamen                </span>
                    <span class="n">l</span><span class="o">=</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2"> Anzahl der Spaltennamen die mehrfach vorkommen: </span><span class="si">{:d}</span><span class="s2">; eliminieren der mehrfach vorkommenden ... &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)))</span>
                        <span class="n">mx</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="o">~</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()]</span>
                           
                    <span class="n">l</span><span class="o">=</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>    
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2"> Anzahl der Spalten nach Ergaenzung der Vektorspalten und nach eliminieren der mehrfach vorkommenden: </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)))</span>
                        
                        
                <span class="k">except</span> <span class="n">Mx</span><span class="o">.</span><span class="n">MxError</span><span class="p">:</span>
                    <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{logStr:s}</span><span class="s2">mxsVecsResults2MxDf failed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span><span class="p">)</span>     
                    <span class="k">raise</span> <span class="n">readDxAndMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>             
        
            <span class="c1">### Vector-Results 2 MxDfVecAggs</span>
            <span class="k">if</span> <span class="n">mxsVecsResults2MxDfVecAggs</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>         
                    <span class="k">for</span> <span class="n">idxTime</span> <span class="ow">in</span> <span class="n">mxsVecsResults2MxDfVecAggs</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">aTime</span><span class="o">=</span><span class="n">mx</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">idxTime</span><span class="p">]</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">: Requested Timestep </span><span class="si">{</span><span class="n">idxTime</span><span class="si">}</span><span class="s2"> not in MX-Results.&quot;</span><span class="p">)</span>  
                            <span class="k">continue</span>
                        
                        <span class="n">df</span><span class="p">,</span><span class="n">tL</span><span class="p">,</span><span class="n">tR</span><span class="o">=</span><span class="n">mx</span><span class="o">.</span><span class="n">getVecAggs</span><span class="p">(</span><span class="n">time1st</span><span class="o">=</span><span class="n">aTime</span><span class="p">,</span><span class="n">aTIME</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                                            
                <span class="k">except</span> <span class="n">Mx</span><span class="o">.</span><span class="n">MxError</span><span class="p">:</span>
                    <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{logStr:s}</span><span class="s2">mxsVecsResults2MxDf failed&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="o">=</span><span class="n">logStr</span><span class="p">)</span>     
                    <span class="k">raise</span> <span class="n">readDxAndMxError</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>             

        

                               
    <span class="k">except</span> <span class="n">readDxAndMxGoto</span><span class="p">:</span>        
        <span class="k">pass</span> 

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>      
        
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;_Done.&#39;</span><span class="p">))</span>  
        <span class="c1">#return m</span>

<span class="k">class</span> <span class="nc">readMxError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="readMx"><a class="viewcode-back" href="../functions.html#dxAndMxHelperFcts.readMx">[docs]</a><span class="k">def</span> <span class="nf">readMx</span><span class="p">(</span><span class="n">wDirMx</span><span class="p">,</span> <span class="n">logPathOutputFct</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads SIR 3S results and returns a Mx object.</span>

<span class="sd">    :param wDirMx: Path to Mx-Directory. The results are read into a Mx object via the Mx files.</span>
<span class="sd">    :type wDirMx: str</span>
<span class="sd">    :param logPathOutputFct: func logPathOutputFct(fileName) is used for logoutput of filenames unless explicitly stated otherwise in the logoutput. Defaults to os.path.relpath.</span>
<span class="sd">    :type logPathOutputFct: func, optional, default=os.path.relpath</span>

<span class="sd">    :return: Mx object with two attributes: </span>
<span class="sd">             - mx.df: pandas-Df (&#39;time curve data&#39;) from from SIR 3S&#39; MXS file(s)</span>
<span class="sd">             - mx.dfVecAggs: pandas-Df (&#39;vector data&#39;) from SIR 3S&#39; MXS file(s)</span>
<span class="sd">    :rtype: Mx object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">mx</span><span class="o">=</span><span class="kc">None</span>
    
    <span class="n">logStrPrefix</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">Start.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">))</span>   
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Use glob to find all MX1 files in the directory</span>
        <span class="n">mx1_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wDirMx</span><span class="p">,</span> <span class="s1">&#39;**&#39;</span><span class="p">,</span> <span class="s1">&#39;*.MX1&#39;</span><span class="p">),</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Get the parent directories of the MX1 files</span>
        <span class="n">parent_dirs</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">mx1_files</span><span class="p">)</span>

        <span class="c1"># Check the number of directories found</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_dirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">Mehr als ein Verzeichnis mit MX1-Dateien gefunden.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">))</span>
            <span class="k">for</span> <span class="nb">dir</span> <span class="ow">in</span> <span class="n">parent_dirs</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">Verzeichnis: </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">,</span> <span class="nb">dir</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">readMxError</span><span class="p">(</span><span class="s2">&quot;Mehr als ein Verzeichnis mit MX1-Dateien gefunden.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">parent_dirs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">wDirMx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parent_dirs</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">Keine Verzeichnisse mit MX1-Dateien gefunden.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">))</span>
            <span class="k">raise</span> <span class="n">readMxError</span><span class="p">(</span><span class="s2">&quot;Keine Verzeichnisse mit MX1-Dateien gefunden.&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">Ein Fehler ist aufgetreten beim Suchen von MX1-Verzeichnissen: </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
        <span class="k">raise</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">wDirMx von abspath von wDir von dbFile: </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">,</span> <span class="n">wDirMx</span><span class="p">))</span>
        
        <span class="n">wDirMxMx1Content</span><span class="o">=</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wDirMx</span><span class="p">,</span><span class="s1">&#39;*.MX1&#39;</span><span class="p">))</span>
        <span class="n">wDirMxMx1Content</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">wDirMxMx1Content</span><span class="p">)</span> 

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wDirMxMx1Content</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">Mehr als 1 (</span><span class="si">{1:d}</span><span class="s2">) MX1 in wDirMx vorhanden.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wDirMxMx1Content</span><span class="p">)))</span>
        <span class="n">mx1File</span><span class="o">=</span> <span class="n">wDirMxMx1Content</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">mx1File: </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">,</span> <span class="n">logPathOutputFct</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)))</span>
        
    <span class="k">except</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">Problem mit dem MX1-Dateipfad&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">))</span>
        
    <span class="k">try</span><span class="p">:</span>
        <span class="n">mx</span><span class="o">=</span><span class="n">Mx</span><span class="o">.</span><span class="n">Mx</span><span class="p">(</span><span class="n">mx1File</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">MX wurde bisher erfolgreich gelesen. </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">,</span> <span class="n">mx1File</span><span class="p">))</span>   
    <span class="k">except</span> <span class="n">Mx</span><span class="o">.</span><span class="n">MxError</span><span class="p">:</span>  
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">MX1-Datei konnte nicht gelesen werden&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">))</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">_Done.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStrPrefix</span><span class="p">))</span> 
    
    <span class="k">return</span> <span class="n">mx</span></div>

<span class="k">def</span> <span class="nf">constructNewMultiindexFromCols</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span><span class="n">mColNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OBJTYPE&#39;</span><span class="p">,</span><span class="s1">&#39;OBJID&#39;</span><span class="p">],</span><span class="n">mIdxNames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;OBJTYPE&#39;</span><span class="p">,</span><span class="s1">&#39;OBJID&#39;</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructs a new Multiindex from existing cols and returns the constructed df.</span>

<span class="sd">        Args:</span>
<span class="sd">            * df: dataFrame without Multiindex              </span>
<span class="sd">            * mColNames: list of columns which shall be used as Multiindex; the columns must exist; the columns will be droped</span>
<span class="sd">            * mIdxNames: list of names for the indices for the Cols above</span>

<span class="sd">        Returns:</span>
<span class="sd">            * df with Multiindex       </span>
<span class="sd">            * empty DataFrame is returned if an Error occurs</span>
<span class="sd">                   </span>
<span class="sd">        &gt;&gt;&gt; d = {&#39;OBJTYPE&#39;: [&#39;ROHR&#39;, &#39;VENT&#39;], &#39;pk&#39;: [123, 345], &#39;data&#39;: [&#39;abc&#39;, &#39;def&#39;]}</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame(data=d)</span>
<span class="sd">        &gt;&gt;&gt; from Xm import Xm</span>
<span class="sd">        &gt;&gt;&gt; df=Xm.constructNewMultiindexFromCols(df=df,mColNames=[&#39;OBJTYPE&#39;,&#39;pk&#39;],mIdxNames=[&#39;OBJTYPE&#39;,&#39;OBJID&#39;])</span>
<span class="sd">        &gt;&gt;&gt; df[&#39;data&#39;]</span>
<span class="sd">        OBJTYPE  OBJID</span>
<span class="sd">        ROHR     123      abc</span>
<span class="sd">        VENT     345      def</span>
<span class="sd">        Name: data, dtype: object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logStr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2">.</span><span class="si">{1:s}</span><span class="s2">: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;Start.&#39;</span><span class="p">))</span> 
    
        <span class="k">try</span><span class="p">:</span>    
            
            <span class="n">arrays</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">mColNames</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}{</span><span class="n">col</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">arrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">logStr</span><span class="si">}</span><span class="s2">arrays: </span><span class="si">{</span><span class="n">arrays</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">tuples</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">arrays</span><span class="p">)))</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">(</span><span class="n">tuples</span><span class="p">,</span><span class="n">names</span><span class="o">=</span><span class="n">mIdxNames</span><span class="p">)</span>
            <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">mColNames</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   
            <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="c1">#df = df.sort_index() # PerformanceWarning: indexing past lexsort depth may impact performance.</span>
            <span class="k">return</span> <span class="n">df</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logStrFinal</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">{:s}</span><span class="s2">Exception: Line: </span><span class="si">{:d}</span><span class="s2">: </span><span class="si">{!s:s}</span><span class="s2">: </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">tb_lineno</span><span class="p">,</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">logStrFinal</span><span class="p">)</span>    
            <span class="k">raise</span> <span class="c1">#df=pd.DataFrame()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logStr</span><span class="p">,</span><span class="s1">&#39;_Done.&#39;</span><span class="p">))</span>
            <span class="c1">#return df  </span>
            
<span class="k">def</span> <span class="nf">fStripV3Colik2Tuple</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s2">&quot;(&#39;STAT&#39;, &#39;KNOT~*~*~*~PH&#39;, Timestamp(&#39;2024-09-01 08:00:00&#39;), Timestamp(&#39;2024-09-01 08:00:00&#39;))_i&quot;</span>
                        <span class="p">,</span><span class="n">colPost</span><span class="o">=</span><span class="s1">&#39;_i&#39;</span><span class="p">):</span>
    
    <span class="n">colRstrip</span><span class="o">=</span><span class="n">col</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">colPost</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">colStrip</span><span class="o">=</span><span class="n">colRstrip</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>            
    <span class="n">colStrip</span><span class="o">=</span><span class="n">colStrip</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>            
    <span class="n">colTupleLst</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">colStrip</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
                
    <span class="n">colTuple</span><span class="o">=</span><span class="p">(</span><span class="n">colTupleLst</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
             <span class="p">,</span><span class="n">colTupleLst</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">+</span><span class="n">colPost</span>
             <span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">colTupleLst</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
             <span class="p">,</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="n">colTupleLst</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">colTuple</span>

<span class="k">def</span> <span class="nf">fGetMultiindexTupleFromV3Col</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="nb">tuple</span><span class="p">):</span>        
        <span class="k">return</span> <span class="n">col</span>
    
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
        
        <span class="c1"># ergaenzte Knotenwerte</span>
        
        <span class="n">mObj</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;\)(?P&lt;Postfix&gt;_i)$&#39;</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>        
        <span class="k">if</span> <span class="n">mObj</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>        
            <span class="k">return</span> <span class="n">fStripV3Colik2Tuple</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">mObj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Postfix&#39;</span><span class="p">))</span> 
        
        <span class="n">mObj</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;\)(?P&lt;Postfix&gt;_k)$&#39;</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>        
        <span class="k">if</span> <span class="n">mObj</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>                
            <span class="k">return</span> <span class="n">fStripV3Colik2Tuple</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">mObj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Postfix&#39;</span><span class="p">))</span> 
        
        <span class="n">mObj</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s1">&#39;\)(?P&lt;Postfix&gt;_n)$&#39;</span><span class="p">,</span><span class="n">col</span><span class="p">)</span>        
        <span class="k">if</span> <span class="n">mObj</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>                
            <span class="k">return</span> <span class="n">fStripV3Colik2Tuple</span><span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="n">mObj</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;Postfix&#39;</span><span class="p">))</span> 
            
        <span class="c1"># keine ergaenzte Knotenwerte    </span>
        <span class="k">return</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>   
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 1986-2024, 3S Consult GmbH.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>